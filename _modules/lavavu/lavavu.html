
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>lavavu.lavavu &#8212; LavaVu 1.3.2 documentation</title>
    <link rel="stylesheet" href="../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LavaVu 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for lavavu.lavavu</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">LavaVu python interface: viewer utils &amp; wrapper</span>

<span class="sd">TODO:</span>
<span class="sd">    Documentation intro / header</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#NOTE: regarding sync of state between python and library</span>
<span class="c1">#- sync from python to lavavu is immediate,</span>
<span class="c1">#    property setting must always trigger a sync to lavavu</span>
<span class="c1">#- sync from lavavu to python is lazy, always need to call _get()</span>
<span class="c1">#    before using state data</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">control</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">weakref</span>

<span class="kn">from</span> <span class="nn">vutils</span> <span class="k">import</span> <span class="n">is_ipython</span><span class="p">,</span> <span class="n">is_notebook</span>

<span class="c1">#import swig module</span>
<span class="kn">import</span> <span class="nn">LavaVuPython</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">version</span>

<span class="n">TOL_DEFAULT</span> <span class="o">=</span> <span class="mf">0.0001</span> <span class="c1">#Default error tolerance for image tests</span>
<span class="n">TIMER_MAX_FPS</span> <span class="o">=</span> <span class="mi">200</span>   <span class="c1">#FPS for frame timer</span>
<span class="n">TIMER_INC</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">TIMER_MAX_FPS</span> <span class="c1">#Timer increment in milliseconds</span>

<span class="n">geomnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;triangles&quot;</span><span class="p">,</span> <span class="s2">&quot;vectors&quot;</span><span class="p">,</span> <span class="s2">&quot;tracers&quot;</span><span class="p">,</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span> <span class="s2">&quot;volumes&quot;</span><span class="p">,</span> <span class="s2">&quot;screen&quot;</span><span class="p">]</span>
<span class="n">geomtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucLabelType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucPointType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucGridType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucTriangleType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucVectorType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucTracerType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucLineType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucShapeType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucVolumeType</span><span class="p">,</span>
             <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucScreenType</span><span class="p">]</span>

<span class="n">datatypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vertices&quot;</span><span class="p">:</span>  <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucVertexData</span><span class="p">,</span>
             <span class="s2">&quot;normals&quot;</span><span class="p">:</span>   <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucNormalData</span><span class="p">,</span>
             <span class="s2">&quot;vectors&quot;</span><span class="p">:</span>   <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucVectorData</span><span class="p">,</span>
             <span class="s2">&quot;indices&quot;</span><span class="p">:</span>   <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucIndexData</span><span class="p">,</span>
             <span class="s2">&quot;colours&quot;</span><span class="p">:</span>   <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucRGBAData</span><span class="p">,</span>
             <span class="s2">&quot;texcoords&quot;</span><span class="p">:</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucTexCoordData</span><span class="p">,</span>
             <span class="s2">&quot;luminance&quot;</span><span class="p">:</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucLuminanceData</span><span class="p">,</span>
             <span class="s2">&quot;rgb&quot;</span><span class="p">:</span>       <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucRGBData</span><span class="p">,</span>
             <span class="s2">&quot;rgba&quot;</span><span class="p">:</span>      <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucRGBAData</span><span class="p">,</span>
             <span class="s2">&quot;values&quot;</span><span class="p">:</span>    <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucMaxDataType</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">_convert_keys</span><span class="p">(</span><span class="n">dictionary</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="c1">#Not necessary in python3...</span>
        <span class="k">return</span> <span class="n">dictionary</span>
    <span class="sd">&quot;&quot;&quot;Recursively converts dictionary keys</span>
<span class="sd">       and unicode values to utf-8 strings.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)):</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert_keys</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dictionary</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dictionary</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">_convert_keys</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">_CustomEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CustomEncoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_convert_args</span><span class="p">(</span><span class="n">dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a kwargs dict to a json string argument list</span>
<span class="sd">       Ensure all elements can be converted by using custom encoder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">_CustomEncoder</span><span class="p">))</span>

<div class="viewcode-block" id="grid2d"><a class="viewcode-back" href="../../lavavu.html#lavavu.grid2d">[docs]</a><span class="k">def</span> <span class="nf">grid2d</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)),</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a 2d grid of vertices</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    corners : tuple or list</span>
<span class="sd">        top left and bottom right corner vertices (2d)</span>
<span class="sd">    dims : tuple or list</span>
<span class="sd">        dimensions of grid nodes, number of vertices to generate in each direction</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vertices : array</span>
<span class="sd">        The 2d vertices of the generated grid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">vertices</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="grid3d"><a class="viewcode-back" href="../../lavavu.html#lavavu.grid3d">[docs]</a><span class="k">def</span> <span class="nf">grid3d</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)),</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a 2d grid of vertices in 3d space</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    corners : tuple or list</span>
<span class="sd">        3 or 4 corner vertices (3d)</span>
<span class="sd">    dims : tuple or list</span>
<span class="sd">        dimensions of grid nodes, number of vertices to generate in each direction</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vertices : array</span>
<span class="sd">        The 3d vertices of the generated 2d grid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Must provide 2d grid index dimensions&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Must provide 3 or 4 corners of grid&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Must provide 3d coordinates of grid corners&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="c1">#Calculate 4th corner</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">AB</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">B</span><span class="p">)</span>
        <span class="n">AC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">C</span><span class="p">)</span>
        <span class="n">BC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">C</span><span class="p">)</span>
        <span class="n">MAX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">AB</span><span class="p">,</span> <span class="n">AC</span><span class="p">,</span> <span class="n">BC</span><span class="p">])</span>
        <span class="c1">#Create new point opposite longest side of triangle</span>
        <span class="k">if</span> <span class="n">BC</span> <span class="o">==</span> <span class="n">MAX</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">AC</span> <span class="o">==</span> <span class="n">MAX</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">C</span> <span class="o">-</span> <span class="n">B</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">-</span> <span class="n">C</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Sort to ensure vertex order correct</span>
        <span class="k">def</span> <span class="nf">vertex_compare</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="k">return</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">v0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">return</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">v0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">return</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="kn">import</span> <span class="nn">functools</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">corners</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">vertex_compare</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">lerp</span><span class="p">(</span><span class="n">coord0</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Linear interpolation between two 3d points&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">coord0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">coord0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">coord0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coord1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">bot</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">top</span>
    <span class="n">lines</span><span class="p">[</span><span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">bot</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="cubeHelix"><a class="viewcode-back" href="../../lavavu.html#lavavu.cubeHelix">[docs]</a><span class="k">def</span> <span class="nf">cubeHelix</span><span class="p">(</span><span class="n">samples</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rot</span><span class="o">=-</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sat</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create CubeHelix spectrum colourmap with monotonically increasing/descreasing intensity</span>

<span class="sd">    Implemented from FORTRAN 77 code from D.A. Green, 2011, BASI, 39, 289.</span>
<span class="sd">    &quot;A colour scheme for the display of astronomical intensity images&quot;</span>
<span class="sd">    http://adsabs.harvard.edu/abs/2011arXiv1108.5083G</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    samples : int</span>
<span class="sd">        Number of colour samples to produce</span>
<span class="sd">    start : float</span>
<span class="sd">        Start colour [0,3] 1=red,2=green,3=blue</span>
<span class="sd">    rot : float</span>
<span class="sd">        Rotations through spectrum, negative to reverse direction</span>
<span class="sd">    sat : float</span>
<span class="sd">        Colour saturation grayscale to full [0,1], &gt;1 to oversaturate</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Gamma correction [0,1]</span>
<span class="sd">    alpha : list or tuple</span>
<span class="sd">        Alpha [min,max] for transparency ramp</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of colours ready to be loaded by colourmap()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colours</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
        <span class="c1">#Convert as boolean</span>
        <span class="k">if</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">samples</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">fract</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">start</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">rot</span> <span class="o">*</span> <span class="n">fract</span><span class="p">)</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="n">sat</span> <span class="o">*</span> <span class="n">fract</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fract</span><span class="p">)</span>
        <span class="n">fract</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">fract</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">fract</span> <span class="o">+</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.14861</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.78277</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">fract</span> <span class="o">+</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.29227</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.90649</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">fract</span> <span class="o">+</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="o">+</span><span class="mf">1.97294</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>

        <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">fract</span>

        <span class="n">colours</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fract</span><span class="p">,</span> <span class="s1">&#39;rgba(</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="mh">0xff</span><span class="p">,</span> <span class="n">g</span><span class="o">*</span><span class="mh">0xff</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="mh">0xff</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="mh">0xff</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">colours</span></div>

<div class="viewcode-block" id="matplotlib_colourmap"><a class="viewcode-back" href="../../lavavu.html#lavavu.matplotlib_colourmap">[docs]</a><span class="k">def</span> <span class="nf">matplotlib_colourmap</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import a colourmap from a matplotlib</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of the matplotlib colourmap preset to import</span>
<span class="sd">    samples : int</span>
<span class="sd">        Number of samples to take for LinearSegmentedColormap type</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of colours ready to be loaded by colourmap()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">):</span>
            <span class="c1">#Reduce length? many MPL maps have 256 samples,</span>
            <span class="c1">#unnecessary since we are already interpolating</span>
            <span class="c1">#Can disable this by setting samples=None</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">colors</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">256</span> <span class="ow">and</span> <span class="n">samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">subsample</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">256</span><span class="o">/</span><span class="n">samples</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">subsample</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="c1">#Get colour samples when no list provided</span>
        <span class="k">if</span> <span class="n">samples</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="n">samples</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">colours</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">i</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">colours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">colours</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1">#Assume single colour value, just return it</span>
        <span class="k">return</span> <span class="n">name</span>
    <span class="k">return</span> <span class="p">[]</span></div>

<span class="c1">#Module settings</span>
<span class="c1">#must be an object or won&#39;t be referenced from __init__.py import</span>
<span class="c1">#(enures values are passed on when set externally)</span>
<span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1">#Default arguments for viewer creation</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;default_args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#Dump base64 encoded images on test failure for debugging</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;echo_fails&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1">#Wrapper class for drawing object</span>
<span class="c1">#handles property updating via internal dict</span>
<div class="viewcode-block" id="Object"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object">[docs]</a><span class="k">class</span> <span class="nc">Object</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    The Object class provides an interface to a LavaVu drawing object</span>
<span class="sd">    Object instances are created internally in the Viewer class and can</span>
<span class="sd">    be retrieved from the object list</span>

<span class="sd">    New objects are also created using viewer methods</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Initial set of properties passed to the created object</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        </span>
<span class="sd">    Create a viewer, load some test data, get objects</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import lavavu</span>
<span class="sd">    &gt;&gt;&gt; lv = lavavu.Viewer()</span>
<span class="sd">    &gt;&gt;&gt; lv.test()</span>
<span class="sd">    &gt;&gt;&gt; print(lv.objects)</span>

<span class="sd">    Object properties can be passed in when created or set by using as a dictionary:</span>

<span class="sd">    &gt;&gt;&gt; obj = lv.points(pointtype=&quot;sphere&quot;)</span>
<span class="sd">    &gt;&gt;&gt; obj[&quot;pointsize&quot;] = 5</span>

<span class="sd">    A list of available properties can be found here: https://github.com/OKaluza/LavaVu/wiki/Property-Reference</span>
<span class="sd">    or by using the online help:</span>

<span class="sd">    &gt;&gt;&gt; obj.help(&#39;opacity&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;filters&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#Create a control factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">_ControlFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#Init prop dict for tab completion</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Object</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the object&#39;s name property</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        name: str</span>
<span class="sd">            The name of the object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_setprops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="c1">#Replace props with new data from app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Send updated props (via ref in case name changed)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_setupobject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="c1">#TODO: get colourmap properties from associated colourmap???</span>
        <span class="c1">#cmap = {}</span>
        <span class="c1">#if &quot;colourmap&quot; in self.dict:</span>
        <span class="c1">#    cmid = self.dict[&quot;colourmap&quot;]</span>
        <span class="c1">#    cmap = ColourMap(cmid, self.parent)</span>
        <span class="c1">#if key in cmap:</span>
        <span class="c1">#    return cmap[key]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="c1">#Check for valid key</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="c1">#Default to the property lookup dict (default value is first element)</span>
        <span class="c1">#(allows default values to be returned from prop get)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Object</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="c1">#Must always return a copy to prevent modifying the defaults!</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1">#Check for valid key</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;colourmap&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">ColourMap</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ColourMap</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="c1">#Use name instead of object when setting colourmap on object</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getColourMap</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="c1">#Not found by passed id/name/ref, use the value to set map data</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colourmap</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">parseProperty</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">_convert_args</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Default string representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="k">return</span> <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="c1">#Interface for setting filters</span>
<div class="viewcode-block" id="Object.include"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.include">[docs]</a>    <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter data by including a range of values</span>
<span class="sd">        shortcut for: filter(... , out=False)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str</span>
<span class="sd">            Data label to filter on</span>
<span class="sd">        values : number or list or tuple</span>
<span class="sd">            value range single value, list or tuple</span>
<span class="sd">            if a single value the filter applies to only this value: x == value</span>
<span class="sd">            if a list  eg: [0,1] range is inclusive 0 &lt;= x &lt;= 1</span>
<span class="sd">            if a tuple eg: (0,1) range is exclusive 0 &lt; x &lt; 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The filter id created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.includemap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.includemap">[docs]</a>    <span class="k">def</span> <span class="nf">includemap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter data by including a range of mapped values</span>
<span class="sd">        shortcut for: filter(... , out=False, map=True)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str</span>
<span class="sd">            Data label to filter on</span>
<span class="sd">        values : number or list or tuple</span>
<span class="sd">            value range single value, list or tuple</span>
<span class="sd">            if a single value the filter applies to only this value: x == value</span>
<span class="sd">            if a list  eg: [0,1] range is inclusive 0 &lt;= x &lt;= 1</span>
<span class="sd">            if a tuple eg: (0,1) range is exclusive 0 &lt; x &lt; 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The filter id created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.exclude"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.exclude">[docs]</a>    <span class="k">def</span> <span class="nf">exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter data by excluding a range of values</span>
<span class="sd">        shortcut for: filter(... , out=True)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str</span>
<span class="sd">            Data label to filter on</span>
<span class="sd">        values : number or list or tuple</span>
<span class="sd">            value range single value, list or tuple</span>
<span class="sd">            if a single value the filter applies to only this value: x == value</span>
<span class="sd">            if a list  eg: [0,1] range is inclusive 0 &lt;= x &lt;= 1</span>
<span class="sd">            if a tuple eg: (0,1) range is exclusive 0 &lt; x &lt; 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The filter id created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="Object.excludemap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.excludemap">[docs]</a>    <span class="k">def</span> <span class="nf">excludemap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter data by excluding a range of mapped values</span>
<span class="sd">        shortcut for: filter(... , out=True, map=True)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str</span>
<span class="sd">            Data label to filter on</span>
<span class="sd">        values : number or list or tuple</span>
<span class="sd">            value range single value, list or tuple</span>
<span class="sd">            if a single value the filter applies to only this value: x == value</span>
<span class="sd">            if a list  eg: [0,1] range is inclusive 0 &lt;= x &lt;= 1</span>
<span class="sd">            if a tuple eg: (0,1) range is exclusive 0 &lt; x &lt; 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The filter id created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.filter"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter data by including a range of values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str</span>
<span class="sd">            Data label to filter on</span>
<span class="sd">        values : number or list or tuple</span>
<span class="sd">            value range single value, list or tuple</span>
<span class="sd">            if a single value the filter applies to only this value: x == value</span>
<span class="sd">            if a list  eg: [0,1] range is inclusive 0 &lt;= x &lt;= 1</span>
<span class="sd">            if a tuple eg: (0,1) range is exclusive 0 &lt; x &lt; 1</span>
<span class="sd">        out : boolean</span>
<span class="sd">            Set this flag to filter out values instead of including them</span>
<span class="sd">        map : boolean</span>
<span class="sd">            Set this flag to filter by normalised values mapped to [0,1]</span>
<span class="sd">            instead of actual min/max of the data range</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The filter id created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Pass a single value to include/exclude exact value</span>
        <span class="c1">#Pass a tuple for exclusive range (min &lt; val &lt; max)</span>
        <span class="c1"># list for inclusive range (min &lt;= val &lt;= max)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure have latest data</span>
        <span class="n">filterlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;filters&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">filterlist</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">,</span><span class="n">values</span><span class="p">]</span>
        <span class="n">newfilter</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;by&quot;</span> <span class="p">:</span> <span class="n">label</span><span class="p">,</span> <span class="s2">&quot;minimum&quot;</span> <span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;maximum&quot;</span> <span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;map&quot;</span> <span class="p">:</span> <span class="nb">map</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span> <span class="p">:</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;inclusive&quot;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">newfilter</span><span class="p">[</span><span class="s2">&quot;inclusive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">filterlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newfilter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">parseProperty</span><span class="p">(</span><span class="s1">&#39;filters=&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">filterlist</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve available labelled data sets on this object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary containing the data objects available by label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Return data sets dict converted from json string</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getObjectDataLabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">sets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">sets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">_convert_keys</span><span class="p">(</span><span class="n">sets</span><span class="p">)</span>

<div class="viewcode-block" id="Object.append"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a new data element to the object</span>

<span class="sd">        Object data is sometimes dependant on individual elements to</span>
<span class="sd">        determine where one part ends and another starts, eg: line segments, grids</span>

<span class="sd">        This allows manually closing the active element so all new data is loaded into a new element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">appendToObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.triangles"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.triangles">[docs]</a>    <span class="k">def</span> <span class="nf">triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load triangle data,</span>

<span class="sd">        This is the same as loading vertices into a triangle mesh object but allows</span>
<span class="sd">        decomposing the mesh into smaller triangles with the split option</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        split : int</span>
<span class="sd">            Split triangles this many times on loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">split</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadTriangles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#Prepare a data set</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1">#Convert to numpy array first</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#Transform to requested data type if provided</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1">#Always convert float64 to float32</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1">#Masked array? Set fill value to NaN</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">!=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: setting masked array fill to NaN, was: &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">set_fill_value</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filled</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_loadScalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">geomdtype</span><span class="p">):</span>
        <span class="c1">#Passes a scalar dataset (float/uint8/uint32)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#Load as flattened 1d array</span>
        <span class="c1">#(ravel() returns view rather than copy if possible, flatten() always copies)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">arrayFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">geomdtype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">arrayUInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">geomdtype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">arrayUChar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">geomdtype</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_checkDims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="c1">#User provided dims value</span>
        <span class="k">if</span> <span class="s1">&#39;dims&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dims&quot;</span><span class="p">]</span>
            <span class="c1">#Dims match provided data?</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">D</span> <span class="o">!=</span> <span class="n">size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: provided &#39;dims&#39; property doesn&#39;t match data size: &quot;</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: provided &#39;dims&#39; property doesn&#39;t match data size: &quot;</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: provided &#39;dims&#39; property doesn&#39;t match data size: &quot;</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: provided &#39;dims&#39; property doesn&#39;t match data size: &quot;</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="p">)</span>

            <span class="c1">#As data found, skip auto-calc of dims</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1">#No user data, calculate the dims if possible</span>
        <span class="k">return</span> <span class="kc">False</span>


    <span class="k">def</span> <span class="nf">_volumeDimsFromShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1">#Volume? Use the shape as dims if not provided on value data load</span>

        <span class="c1">#If dims not set or don&#39;t match provided data?</span>
        <span class="c1">#3D shape required</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkDims</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1">#Need to flip for volume? (if in expected numpy order of Z,Y,X)</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dims&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">_gridDimsFromShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1">#Quads grid? Use the data.shape as dims if not provided on vertex data load</span>

        <span class="c1">#3D shape required [y, x, 3]</span>
        <span class="c1">#Dims set or already match provided data? skip</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkDims</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1">#Use matching shape dimensions, numpy [rows, cols] lavavu [width(cols), height(rows)]</span>
            <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dims&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#columns</span>
                <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#rows</span>
            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1">#columns</span>
                <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#rows</span>
            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1">#columns</span>
                <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#rows</span>
                <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dims&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span>

    <span class="k">def</span> <span class="nf">_tracerDimsFromShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1">#Tracers? Use the size if not provided on vertex data load</span>

        <span class="c1">#Dims set or already match provided data?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkDims</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">3</span><span class="p">):</span>
            <span class="c1">#Dims = vertex count</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;dims&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_loadVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">geomdtype</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accepts 2d or 3d data as a list of vertices [[x,y,z]...] or [[x,y]...]</span>
<span class="sd">         - If the last dimension is 2, a zero 3rd element is added to all vertices</span>
<span class="sd">        Also accepts 2d or 3d data as columns [[x...], [y...], [z...]]</span>
<span class="sd">         - In this case, there must be &gt; 3 elements or cannot autodetect!</span>
<span class="sd">         - If the last dimenion is not 3 (or 2) and the first is 3 (or 2)</span>
<span class="sd">           the data will be re-arranged automatically</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Passes a vector dataset (float)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1">#Detection of structure based on shape</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1">#Data provided as separate x,y,z columns? (Must be &gt; 3 elements)</span>
            <span class="k">if</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1">#Re-arrange to array of [x,y,z] triples</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1">#Re-arrange to array of [x,y] pairs</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

            <span class="c1">#Now check for 2d vertices</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1">#Interpret as 2d data... must add 3rd dimension</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1">#Quads or tracers? Use the shape as dims if not provided</span>
            <span class="c1">#Quad/Triangle type?</span>
            <span class="c1">#if self[&quot;geometry&quot;] == &#39;quads&#39; or self[&quot;geometry&quot;] == &#39;grid&#39;:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucGridType</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucTriangleType</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gridDimsFromShape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucTracerType</span><span class="p">]:</span>
            <span class="c1">#elif self[&quot;geometry&quot;] == &#39;tracers&#39;:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tracerDimsFromShape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1">#Convenience option to load magnitude as a value array</span>
        <span class="k">if</span> <span class="n">magnitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">magnitude</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;magnitude&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">arrayFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">mag</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">label</span><span class="p">)</span>

        <span class="c1">#Load as flattened 1d array</span>
        <span class="c1">#(ravel() returns view rather than copy if possible, flatten() always copies)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">arrayFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">geomdtype</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return internal geometry data at current timestep</span>
<span class="sd">        Returns a Geometry() object that can be iterated through containing all data elements</span>
<span class="sd">        Elements contain vertex/normal/value etc. data as numpy arrays</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Geometry</span>
<span class="sd">            An object holding the data elements retrieved</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; for el in obj.data:</span>
<span class="sd">        &gt;&gt;&gt;     print(el)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Object.vertices"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.vertices">[docs]</a>    <span class="k">def</span> <span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load 3d vertex data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy float32 3d array of vertices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadVector</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucVertexData</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.normals"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.normals">[docs]</a>    <span class="k">def</span> <span class="nf">normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load 3d normal data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy float32 3d array of normals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadVector</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucNormalData</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.vectors"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.vectors">[docs]</a>    <span class="k">def</span> <span class="nf">vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load 3d vector data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy float32 3d array of vectors</span>
<span class="sd">        magnitude : str</span>
<span class="sd">            Pass a label to calculate the magnitude and save under provided name (for use in colouring etc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadVector</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucVectorData</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.values"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load value data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy float32 array of values</span>
<span class="sd">        label : str</span>
<span class="sd">            Label for this data set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1">#Volume? Use the shape as dims if not provided</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_volumeDimsFromShape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">arrayFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">label</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.colours"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.colours">[docs]</a>    <span class="k">def</span> <span class="nf">colours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load colour data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : str or list or array</span>
<span class="sd">            Pass a list or numpy uint32 array of colours</span>
<span class="sd">            if a string or list of strings is provided, colours are parsed as html colour string values</span>
<span class="sd">            if a numpy array is passed, colours are loaded as 4 byte ARGB unsigned integer values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadScalar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucRGBAData</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#Convert to list of strings</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span>
        <span class="c1">#Load as string array or unsigned int array</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1">#Convert to strings for json parsing first</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1">#Each element will be parsed as a colour string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadColours</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Plain list, assume unsigned colour data, either 4*uint8 or 1*uint32 per rgba colour</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.indices"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.indices">[docs]</a>    <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load index data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy uint32 array of indices</span>
<span class="sd">            indices are loaded as 32 bit unsigned integer values</span>
<span class="sd">        offset : int</span>
<span class="sd">            Specify an initial index offset, for 1-based indices pass offset=1</span>
<span class="sd">            Default is zero-based</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Accepts only uint32 indices</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Convert indices to offset 0 before loading by subtracting offset</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="c1">#Load indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadScalar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucIndexData</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.rgb"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.rgb">[docs]</a>    <span class="k">def</span> <span class="nf">rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load rgb data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy uint8 array of rgb values</span>
<span class="sd">            values are loaded as 8 bit unsigned integer values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Accepts only uint8 rgb triples</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="c1">#Detection of split r,g,b arrays from shape</span>
        <span class="c1">#If data provided as separate r,g,b columns, re-arrange (Must be &gt; 3 elements to detect correctly)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1">#Re-arrange to array of [r,g,b] triples</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_loadScalar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucRGBData</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.rgba"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.rgba">[docs]</a>    <span class="k">def</span> <span class="nf">rgba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load rgba data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy uint8 array of rgba values</span>
<span class="sd">            values are loaded as 8 bit unsigned integer values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Accepts only uint8 rgba</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="c1">#Detection of split r,g,b arrays from shape</span>
        <span class="c1">#If data provided as separate r,g,b,a columns, re-arrange (Must be &gt; 4 elements to detect correctly)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1">#Re-arrange to array of [r,g,b,a] values</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_loadScalar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucRGBAData</span><span class="p">)</span></div>


<div class="viewcode-block" id="Object.luminance"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.luminance">[docs]</a>    <span class="k">def</span> <span class="nf">luminance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load luminance data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy uint8 array of luminance values</span>
<span class="sd">            values are loaded as 8 bit unsigned integers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Accepts only uint8 luminance values</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadScalar</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucLuminanceData</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.texture"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.texture">[docs]</a>    <span class="k">def</span> <span class="nf">texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mipmaps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bgr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load raw texture data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or array</span>
<span class="sd">            Pass a list or numpy uint32 or uint8 array</span>
<span class="sd">            texture data is loaded as raw image data</span>
<span class="sd">        width : int</span>
<span class="sd">            image width in pixels</span>
<span class="sd">        height : int</span>
<span class="sd">            image height in pixels</span>
<span class="sd">        channels : int</span>
<span class="sd">            colour channels/depth in bytes (1=luminance, 3=RGB, 4=RGBA)</span>
<span class="sd">        flip : boolean</span>
<span class="sd">            flip the texture vertically after loading</span>
<span class="sd">            (default is enabled as usually required for OpenGL but can be disabled)</span>
<span class="sd">        mipmaps : boolean</span>
<span class="sd">            generate mipmaps (slow)</span>
<span class="sd">        bgr : boolean</span>
<span class="sd">            rgb data is in BGR/BGRA format instead of RGB/RGBA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">textureUInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">flip</span><span class="p">,</span> <span class="n">mipmaps</span><span class="p">,</span> <span class="n">bgr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">textureUChar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">flip</span><span class="p">,</span> <span class="n">mipmaps</span><span class="p">,</span> <span class="n">bgr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.labels"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.labels">[docs]</a>    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load label data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or str</span>
<span class="sd">            Pass a label or list of labels to be applied, one per vertex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadLabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.colourmap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.colourmap">[docs]</a>    <span class="k">def</span> <span class="nf">colourmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">monochrome</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load colour map data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or str or ColourMap</span>
<span class="sd">            If not provided, just returns the colourmap</span>
<span class="sd">            (A default is created if none exists)</span>
<span class="sd">            Provided colourmap data can be</span>
<span class="sd">            - a string,</span>
<span class="sd">            - list of colour strings,</span>
<span class="sd">            - list of position,value tuples</span>
<span class="sd">            - a built in colourmap name</span>
<span class="sd">            - An existing ColourMap object</span>
<span class="sd">            Creates a colourmap named objectname_colourmap if object</span>
<span class="sd">            doesn&#39;t already have a colourmap</span>
<span class="sd">        reverse : boolean</span>
<span class="sd">            Reverse the order of the colours after loading</span>
<span class="sd">        monochrome : boolean</span>
<span class="sd">            Convert to greyscale</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ColourMap(dict)</span>
<span class="sd">            The wrapper object of the colourmap loaded/created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmid</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;colourmap&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cmid</span><span class="p">:</span>
                <span class="c1">#Just return the existing map</span>
                <span class="k">return</span> <span class="n">ColourMap</span><span class="p">(</span><span class="n">cmid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Proceeed to create a new map with default data</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">cubeHelix</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ColourMap</span><span class="p">):</span>
            <span class="c1">#Passed a colourmap object</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">colourMap</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ref</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Load colourmap on this object</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">colourMap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">colourMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">addColourMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_colourmap&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;colourmap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">colourMap</span><span class="o">.</span><span class="n">name</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">ColourMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">colourMap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1">#Update with any passed args, colour data etc</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">monochrome</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cmap</span></div>

<div class="viewcode-block" id="Object.opacitymap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.opacitymap">[docs]</a>    <span class="k">def</span> <span class="nf">opacitymap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load opacity map data for object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list or str</span>
<span class="sd">            If not provided, just returns the opacity map</span>
<span class="sd">            (A default is created if none exists)</span>
<span class="sd">            Provided opacity map data can be</span>
<span class="sd">            - list of opacity values,</span>
<span class="sd">            - list of position,opacity tuples</span>
<span class="sd">            Creates an opacity map named objectname_opacitymap if object</span>
<span class="sd">            doesn&#39;t already have an opacity map</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ColourMap(dict)</span>
<span class="sd">            The wrapper object of the opacity map loaded/created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colours</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmid</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;opacitymap&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cmid</span><span class="p">:</span>
                <span class="c1">#Just return the existing map</span>
                <span class="k">return</span> <span class="n">ColourMap</span><span class="p">(</span><span class="n">cmid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Proceeed to create a new map with default data</span>
                <span class="n">colours</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;black:0&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">]</span>
        <span class="c1">#Create colour list using provided opacities</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1">#Contains positions</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">colours</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;black:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="c1">#Ensure first and last positions of list data are always 0 and 1</span>
                <span class="k">if</span> <span class="n">colours</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span> <span class="n">colours</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">colours</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">colours</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span> <span class="n">colours</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">colours</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Opacity only</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">colours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;black:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only list data is supported for opacity maps, length of list must be at least 2&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1">#Load opacity map on this object</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">opacityMap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">opacityMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">addColourMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_opacitymap&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;opacitymap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">opacityMap</span><span class="o">.</span><span class="n">name</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ColourMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">opacityMap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colours</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">opby</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;opacityby&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">opby</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;opacityby&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#Use first field by default</span>
        <span class="k">return</span> <span class="n">c</span></div>
        
<div class="viewcode-block" id="Object.reload"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fully reload the object&#39;s data, recalculating all parameters such as colours</span>
<span class="sd">        that may be cached on the GPU, required after changing some properties</span>
<span class="sd">        so the changes are reflected in the visualisation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">reloadObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.select"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set this object as the selected object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">aobject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span></div>
    
<div class="viewcode-block" id="Object.file"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.file">[docs]</a>    <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load data from a file into this object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to load</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Load file with this object selected (import)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">aobject</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Object.files"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.files">[docs]</a>    <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load data from a series of files into this object (using wildcards or a list)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        files : str</span>
<span class="sd">            Specification of the files to load</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Load file with this object selected (import)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">aobject</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Object.colourbar"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.colourbar">[docs]</a>    <span class="k">def</span> <span class="nf">colourbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new colourbar using this object&#39;s colourmap</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        colourbar : Object</span>
<span class="sd">            The colourbar object created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Create a new colourbar for this object</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">colourbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.clear"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear all visualisation data from this object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">clearObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.cleardata"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.cleardata">[docs]</a>    <span class="k">def</span> <span class="nf">cleardata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear specific visualisation data/values from this object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typename : str</span>
<span class="sd">            Optional filter naming type of data to be cleared,</span>
<span class="sd">            Either a built in type: (vertices/normals/vectors/indices/colours/texcoords/luminance/rgb/values)</span>
<span class="sd">            or a user defined data label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">typename</span> <span class="ow">in</span> <span class="n">datatypes</span><span class="p">:</span>
            <span class="c1">#Found data type name</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">datatypes</span><span class="p">[</span><span class="n">typename</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">clearData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Assume values by label (or all values if blank)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">clearValues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">typename</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.update"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the objects&#39;s visualisation data back to the database</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filter : str</span>
<span class="sd">            Optional filter to type of geometry to be updated, if omitted all will be written</span>
<span class="sd">            (eg: labels, points, grid, triangles, vectors, tracers, lines, shapes, volume)</span>
<span class="sd">        compress : boolean</span>
<span class="sd">            Use zlib compression when writing the geometry data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Update object data at current timestep</span>
        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#Re-writes all data to db for this object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">compress</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Re-writes data to db for this object and geom type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_getRendererType</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="n">compress</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.getcolourmap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.getcolourmap">[docs]</a>    <span class="k">def</span> <span class="nf">getcolourmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the colour map data from the object as a string or list</span>
<span class="sd">        Either return format can be used to create/modify a colourmap</span>
<span class="sd">        with colourmap()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : boolean</span>
<span class="sd">            The default is to return the data as a string of colours separated by semi-colons</span>
<span class="sd">            To instead return a list of (position,[R,G,B,A]) tuples for easier automated processing in python,</span>
<span class="sd">            set this to False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mapdata : str/list</span>
<span class="sd">            The formatted colourmap data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmid</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;colourmap&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getcolourmap</span><span class="p">(</span><span class="n">cmid</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span></div>

<div class="viewcode-block" id="Object.isosurface"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.isosurface">[docs]</a>    <span class="k">def</span> <span class="nf">isosurface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isovalues</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">updatedb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an isosurface from a volume data set using the marching cubes algorithm</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        isovalues : number,list</span>
<span class="sd">            Isovalues to create surfaces for, number or list</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the created object, automatically assigned if not provided</span>
<span class="sd">        convert : bool</span>
<span class="sd">            Setting this flag to True will replace the existing volume object with the</span>
<span class="sd">            newly created isosurface by deleting the volume data and loading the mesh</span>
<span class="sd">            data into the preexisting object</span>
<span class="sd">        updatedb : bool</span>
<span class="sd">            Setting this flag to True will write the newly created/modified data</span>
<span class="sd">            to the database when done</span>
<span class="sd">        compress : boolean</span>
<span class="sd">            Use zlib compression when writing the geometry data</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Initial set of properties passed to the created object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : Object</span>
<span class="sd">            The isosurface object created/converted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Generate and return an isosurface object, </span>
        <span class="c1">#pass properties as kwargs (eg: isovalues=[])</span>
        <span class="k">if</span> <span class="n">isovalues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;isovalues&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isovalues</span>

        <span class="c1">#Create surface, If requested, write the new data to the database</span>
        <span class="n">objref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span> <span class="n">objref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">isosurface</span><span class="p">(</span><span class="n">objref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">_convert_args</span><span class="p">(</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">convert</span><span class="p">)</span>

        <span class="c1">#Get the created/updated object</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error creating isosurface&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ref</span>
        <span class="n">isobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="c1">#Re-write modified types to the database</span>
        <span class="k">if</span> <span class="n">updatedb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">isobj</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucVolumeType</span><span class="p">,</span> <span class="n">compress</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">isobj</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">lucTriangleType</span><span class="p">,</span> <span class="n">compress</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">isobj</span></div>

<div class="viewcode-block" id="Object.help"><a class="viewcode-back" href="../../lavavu.html#lavavu.Object.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get help on an object method or property</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmd : str</span>
<span class="sd">            Command to get help with, if ommitted displays general introductory help</span>
<span class="sd">            If cmd is a property or is preceded with &#39;@&#39; will display property help</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">help</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">boundingbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allsteps</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getBoundingBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">allsteps</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[[</span><span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="n">bb</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">5</span><span class="p">]]]</span></div>

<span class="c1">#Wrapper dict+list of objects</span>
<span class="k">class</span> <span class="nc">_Objects</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    The Objects class is used internally to manage and synchronise the drawing object list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Sync the object list with the viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#Loop through retrieved object list</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">]:</span>
            <span class="c1">#Exists in our own list?</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1">#Update object with new properties</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">_setprops</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Create a new object wrapper</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">Object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">obj</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">o</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="c1">#Flag sync</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1">#Save the object id and reference (use id # to get)</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
            
        <span class="c1">#Delete any objects from stored dict that are no longer present</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">found</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="s1">&#39;  &quot;&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;&quot;: </span><span class="si">{}</span><span class="s1">,</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">rep</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">_ColourComponents</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Class to allow modifying colour components directly as an array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">_ColourList</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Class to allow modifying colour list directly as an array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_ColourComponents</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">position</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">_PositionList</span><span class="p">(</span><span class="n">_ColourList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to allow modifying position list directly as an array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">])</span>

<span class="c1">#Wrapper class for colourmap</span>
<span class="c1">#handles property updating via internal dict</span>
<div class="viewcode-block" id="ColourMap"><a class="viewcode-back" href="../../lavavu.html#lavavu.ColourMap">[docs]</a><span class="k">class</span> <span class="nc">ColourMap</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ColourMap class provides an interface to a LavaVu ColourMap</span>
<span class="sd">    ColourMap instances are created internally in the Viewer class and can</span>
<span class="sd">    be retrieved from the colourmaps list</span>

<span class="sd">    New colourmaps are also created using viewer methods</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Initial set of properties passed to the created colourmap</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">ColourMap</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getColourMap</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Sync</span>

        <span class="c1">#Init prop dict for tab completion</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ColourMap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the colourmap name property</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the colourmap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of colours</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        colours : list</span>
<span class="sd">            A list of colours</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_ColourList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@colours</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">colours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1">#Dummy setter to allow +/+= on colours list</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of colour positions</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        positions : list</span>
<span class="sd">            A list of colour positions [0,1]</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_PositionList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Send updated props (via ref in case name changed)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setColourMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">_convert_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="c1">#Update prop dict</span>
        <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;colourmaps&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="c1">#self.colours = cm[&quot;colours&quot;]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
                <span class="c1">#self.dict.pop(&quot;colours&quot;, None)</span>
                <span class="c1">#print self.dict</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="c1">#Default to the property lookup dict (default is first element)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ColourMap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="c1">#Must always return a copy to prevent modifying the defaults!</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="c1">#Set new value and send</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>

<div class="viewcode-block" id="ColourMap.tolist"><a class="viewcode-back" href="../../lavavu.html#lavavu.ColourMap.tolist">[docs]</a>    <span class="k">def</span> <span class="nf">tolist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the colourmap data as a python list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The colour and position data which can be used to re-create the colourmap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;colours&quot;</span><span class="p">]:</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\d\.]+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;colour&quot;</span><span class="p">])</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">3</span><span class="p">]))]</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span> <span class="n">comp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">arr</span></div>

<div class="viewcode-block" id="ColourMap.tohexstr"><a class="viewcode-back" href="../../lavavu.html#lavavu.ColourMap.tohexstr">[docs]</a>    <span class="k">def</span> <span class="nf">tohexstr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the colourmap colour data as a string with hex rgb:a representation,</span>
<span class="sd">        NOTE: ignores position data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The colour data which can be used to re-create the colourmap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">padhex2</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;colours&quot;</span><span class="p">]:</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\d\.]+&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;colour&quot;</span><span class="p">])</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="n">padhex2</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">padhex2</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">padhex2</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
        <span class="k">return</span> <span class="n">string</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Default string representation</span>
        <span class="n">cmstr</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;colours&quot;</span><span class="p">]:</span>
            <span class="n">cmstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%6.4f</span><span class="s2">=</span><span class="si">%s</span><span class="s2">; &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;colour&quot;</span><span class="p">])</span>
        <span class="n">cmstr</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">cmstr</span>

<div class="viewcode-block" id="ColourMap.update"><a class="viewcode-back" href="../../lavavu.html#lavavu.ColourMap.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">monochrome</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the colour map data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : list,str</span>
<span class="sd">            Provided colourmap data can be</span>
<span class="sd">            - a string,</span>
<span class="sd">            - list of colour strings,</span>
<span class="sd">            - list of position,value tuples</span>
<span class="sd">            - or a built in colourmap name</span>
<span class="sd">        reverse : boolean</span>
<span class="sd">            Reverse the order of the colours after loading</span>
<span class="sd">        monochrome : boolean</span>
<span class="sd">            Convert to greyscale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^[\w_]+$&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#Single word of alphanumeric characters, if not a built-in map, try matplotlib</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">defaultcolourmaps</span><span class="p">():</span>
                    <span class="n">newdata</span> <span class="o">=</span> <span class="n">matplotlib_colourmap</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">newdata</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1">#Load colourmap data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">updateColourMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">_convert_args</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">monochrome</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">monochrome</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span></div></div>

<div class="viewcode-block" id="Fig"><a class="viewcode-back" href="../../lavavu.html#lavavu.Fig">[docs]</a><span class="k">class</span> <span class="nc">Fig</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    The Fig class wraps a set of figure data</span>

<span class="sd">    - Figures represent a full set of visualisation settings,</span>
<span class="sd">      including visibility of chosen objects</span>
<span class="sd">    - A single model can contain many objects and multiple figures, all of which work</span>
<span class="sd">      on the same set of objects, but may not use them all (ie: some are hidden)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1">#Init prop dict for tab completion</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Fig</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="c1">#Activate this figure on viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="c1">#Return key on viewer instance</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="c1">#Default to the property lookup dict (default is first element)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Fig</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="c1">#Must always return a copy to prevent modifying the defaults!</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="c1">#Activate this figure on viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="c1">#Set new value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1">#Save changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;{&quot;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Activate this figure on viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Save changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">savefigure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Activate this figure on viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="c1">#Render</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Activate this figure on viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="c1">#Render</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_LavaVuThreadSafe</span><span class="p">(</span><span class="n">LavaVuPython</span><span class="o">.</span><span class="n">LavaVu</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threaded</span> <span class="o">=</span> <span class="n">threaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closing</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">threaded</span><span class="p">:</span>
            <span class="c1"># Create a condition variable to synchronize resource access</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>

            <span class="c1"># Create the command queue</span>
            <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">deque</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

            <span class="c1">#Safe call return value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_returned</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">_LavaVuThreadSafe</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#def __getattr__(self, attr):</span>
    <span class="c1">#    #Lock?</span>
    <span class="c1">#    return self.app[attr]</span>

    <span class="c1">#def __setattr__(self, attr, value):</span>
    <span class="c1">#    #Lock?</span>
    <span class="c1">#    self.app[attr] = value</span>

    <span class="c1">####################################</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    These functions must be called on the render thread only</span>
<span class="sd">    as they make OpenGL calls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">saferun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">imageJPEG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;imageJPEG&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">imagePNG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;imagePNG&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">video</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">web</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">isoSurface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;isoSurface&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#def safegetstate(self, *args, **kwargs):</span>
    <span class="c1">#    return self._lavavu_call(&#39;getState&#39;, True, *args, **kwargs)</span>

    <span class="c1">#def setState(self, *args, **kwargs):</span>
    <span class="c1">#    return self._lavavu_call(&#39;setState&#39;, True, *args, **kwargs)</span>

    <span class="k">def</span> <span class="nf">commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Parse commands and wait until they are processed</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;parseCommands&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qcommands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Queue commands for parsing and return immediately to continue processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;parseCommands&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addTimeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;addTimeStep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">imageDiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;imageDiff&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">loadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;loadFile&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updateColourMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;updateColourMap&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gl_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lavavu_call</span><span class="p">(</span><span class="s1">&#39;gl_version&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #def loadColours(self, *args, **kwargs):</span>
<span class="sd">    #    #print(&quot;COLOURS&quot;)</span>
<span class="sd">    #    return self._lavavu_call(&#39;loadColours&#39;, True, *args, **kwargs)</span>

<span class="sd">    def arrayFloat(self, *args, **kwargs):</span>
<span class="sd">        return self._lavavu_call(&#39;arrayFloat&#39;, True, *args, **kwargs)</span>
<span class="sd">        #self._lavavu_call(&#39;arrayFloat&#39;, False, *args, **kwargs)</span>

<span class="sd">    def arrayUInt(self, *args, **kwargs):</span>
<span class="sd">        return self._lavavu_call(&#39;arrayUInt&#39;, True, *args, **kwargs)</span>
<span class="sd">        #self._lavavu_call(&#39;arrayUInt&#39;, False, *args, **kwargs)</span>

<span class="sd">    def arrayUChar(self, *args, **kwargs):</span>
<span class="sd">        return self._lavavu_call(&#39;arrayUChar&#39;, True, *args, **kwargs)</span>
<span class="sd">        #self._lavavu_call(&#39;arrayUChar&#39;, False, *args, **kwargs)</span>

<span class="sd">    def clearData(self, *args, **kwargs):</span>
<span class="sd">        return self._lavavu_call(&#39;clearData&#39;, True, *args, **kwargs)</span>

<span class="sd">    def clearValues(self, *args, **kwargs):</span>
<span class="sd">        return self._lavavu_call(&#39;clearValues&#39;, True, *args, **kwargs)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">####################################</span>

    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Don&#39;t wait for return value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_openglviewer_call</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#return self._openglviewer_call(&#39;display&#39;, True, *args, **kwargs)</span>

    <span class="c1">#def events(self, *args, **kwargs):</span>
    <span class="c1">#    return self._openglviewer_call(&#39;events&#39;, True, *args, **kwargs)</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1">#This is a bit weird/broken, it shows the window only if visible is true</span>
            <span class="c1"># and does not set the visible flag</span>
            <span class="c1">#TODO: make behaviour of viewer.show/hide consistent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_openglviewer_call</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="c1">#Also a bit broken, needs fixing,</span>
            <span class="c1">#This is the opposite of show, clears visible flag</span>
            <span class="c1"># and hides window regardless of flag setting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_openglviewer_call</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">nodisplay</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#Handle rendering ourselves</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_openglviewer_call</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#self._openglviewer_call(&#39;events&#39;, False, *args, **kwargs)</span>

        <span class="c1">#self._openglviewer_call(&#39;execute&#39;, False, *args, **kwargs)</span>
        <span class="c1">#Note: no longer calls show() if not visible, need to do manually</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">quitProgram</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#self._openglviewer_call(&#39;execute&#39;, False, *args, **kwargs)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_openglviewer_call</span><span class="p">(</span><span class="s1">&#39;execute&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">####################################</span>

    <span class="c1">#Call LavaVu method from render thread</span>
    <span class="k">def</span> <span class="nf">_lavavu_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wait_return</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">_LavaVuThreadSafe</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_call</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">wait_return</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#Call OpenGLViewer method from render thread</span>
    <span class="k">def</span> <span class="nf">_openglviewer_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wait_return</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread_call</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">wait_return</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_thread_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">wait_return</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threaded</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This calls a method on the render thread</span>
<span class="sd">        All args are placed on the queue, along with the method</span>

<span class="sd">        if wait_return is True:</span>
<span class="sd">          Wait for the call to be executed with a condition variable lock</span>
<span class="sd">          Returns the saved return data from render thread after woken</span>
<span class="sd">        Otherwise:</span>
<span class="sd">          Return immediately</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Use the thread queue to pass input args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">wait_return</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="c1">#print(&quot;THREAD_CALL:&quot;,method.__name__,args,kwargs)</span>
        <span class="k">if</span> <span class="n">wait_return</span><span class="p">:</span>
            <span class="c1">#Wait until the call is completed in render thread</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="c1">#Return the saved result data</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_returned</span>

    <span class="k">def</span> <span class="nf">_thread_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function manages the render thread.</span>
<span class="sd">        Used to: handle events, get images</span>
<span class="sd">        All OpenGL calls must be made from here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#self._kwargs[&quot;usequeue&quot;] = True #Switch on command queuing</span>

        <span class="c1">#Render event handling loop!</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closing</span><span class="p">:</span>
            <span class="c1">#Process interactive and timer events</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">events</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

            <span class="c1">#Process commands that must be run on the render thread</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="p">):</span>
                <span class="c1">#if not self.app.viewer.isopen or not self.app.amodel:</span>
                <span class="c1">#    print(&quot;NOT OPEN!&quot;)</span>
                <span class="c1">#    print(&#39;deferring : &#39; + self.app._q[0])</span>
                <span class="n">method</span><span class="p">,</span> <span class="n">wait_return</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
                <span class="c1">#If set, must return result and notify waiting thread with condition variable</span>
                <span class="k">if</span> <span class="n">wait_return</span><span class="p">:</span>
                    <span class="c1">#print(&quot;CALLING:&quot;,method.__name__)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_returned</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="c1">#Notify waiting thread result is ready</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>
                    <span class="c1">#print(&quot;RETURNED:&quot;,type(self._returned))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">method</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">TIMER_INC</span><span class="p">)</span>

            <span class="c1">#Detect window closed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">quitProgram</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
                    <span class="c1">#Just hide the window</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">quitProgram</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<div class="viewcode-block" id="Viewer"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer">[docs]</a><span class="k">class</span> <span class="nc">Viewer</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    *The Viewer class provides an interface to a LavaVu session*</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arglist : list</span>
<span class="sd">        list of additional init arguments to pass</span>
<span class="sd">    database : str</span>
<span class="sd">        initial database (or model) file to load</span>
<span class="sd">    figure : int</span>
<span class="sd">        initial figure id to display</span>
<span class="sd">    timestep : int</span>
<span class="sd">        initial timestep to display</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">        verbose output to command line for debugging</span>
<span class="sd">    interactive : boolean</span>
<span class="sd">        begin in interactive mode, opens gui window and passes control to event loop immediately</span>
<span class="sd">    hidden : boolean</span>
<span class="sd">        begin hidden, for offscreen rendering or web browser control</span>
<span class="sd">    cache : boolean</span>
<span class="sd">        cache all model timesteps in loaded database, everything loaded into memory on startup</span>
<span class="sd">        (assumes enough memory is available)</span>
<span class="sd">    quality : int</span>
<span class="sd">        Render sampling quality, render 2^N times larger image and downsample output</span>
<span class="sd">        For anti-aliasing image rendering where GPU multisample anti-aliasing is not available</span>
<span class="sd">    writeimage : boolean</span>
<span class="sd">        Write images and quit, create images for all figures/timesteps in loaded database then exit</span>
<span class="sd">    resolution : list, tuple</span>
<span class="sd">        Window/image resolution in pixels [x,y]</span>
<span class="sd">    script : list</span>
<span class="sd">        List of script commands to run after initialising</span>
<span class="sd">    initscript : boolean</span>
<span class="sd">        Set to False to disable loading any &quot;init.script&quot; file found in current directory</span>
<span class="sd">    usequeue : boolean</span>
<span class="sd">        Set to True to add all commands to a background queue for processing rather than</span>
<span class="sd">        immediate execution</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Remaining keyword args will be  passed to the created viewer</span>
<span class="sd">        and parsed into the initial set of global properties</span>
<span class="sd">            </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        </span>
<span class="sd">    Create a viewer, setting the initial background colour to white</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import lavavu</span>
<span class="sd">    &gt;&gt;&gt; lv = lavavu.Viewer(background=&quot;white&quot;)</span>

<span class="sd">    Objects can be added by loading files:</span>

<span class="sd">    &gt;&gt;&gt; obj = lv.file(&#39;model.obj&#39;)</span>

<span class="sd">    Or creating empty objects and loading data:</span>

<span class="sd">    &gt;&gt;&gt; obj = lv.points(&#39;mypoints&#39;)</span>
<span class="sd">    &gt;&gt;&gt; obj.vertices([0,0,0], [1,1,1])</span>

<span class="sd">    Viewer commands can be called as methods on the viewer object:</span>

<span class="sd">    &gt;&gt;&gt; lv.rotate(&#39;x&#39;, 45)</span>

<span class="sd">    Viewer properties can be set by using it like a dictionary:</span>

<span class="sd">    &gt;&gt;&gt; lv[&quot;background&quot;] = &quot;grey50&quot;</span>

<span class="sd">    A list of available commands and properties can be found in the wiki</span>

<span class="sd">     - https://github.com/OKaluza/LavaVu/wiki/Scripting-Commands-Reference</span>
<span class="sd">     - https://github.com/OKaluza/LavaVu/wiki/Property-Reference</span>

<span class="sd">    or by using the online help:</span>

<span class="sd">    &gt;&gt;&gt; lv.help(&#39;rotate&#39;)</span>
<span class="sd">    &gt;&gt;&gt; lv.help(&#39;opacity&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Viewer.__init__"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">havecontext</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">omegalib</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and init viewer instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        (see Viewer class docs for setup args)</span>
<span class="sd">        port : int</span>
<span class="sd">            Web server port, open server on specific port for control/interaction</span>
<span class="sd">            Viewer will be run in a separate thread, all rendering will be done in this thread</span>
<span class="sd">            When disabled (None) creates the viewer in the current(main) thread and disables the server</span>
<span class="sd">        binpath : str</span>
<span class="sd">            Override the executable path</span>
<span class="sd">        havecontext : boolean</span>
<span class="sd">            OpenGL context provided by user, set this if you have already setup the context</span>
<span class="sd">        omegalib : boolean</span>
<span class="sd">            For use in VR mode, disables some conflicting functionality</span>
<span class="sd">            and parsed into the initial set of global properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span><span class="mi">480</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ctr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span> <span class="o">=</span> <span class="n">_Objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_managed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#Launch in thread?</span>
        <span class="c1">#(Can disable by setting port=0)</span>
        <span class="k">if</span> <span class="n">port</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Exit handler to clean up threads</span>
            <span class="c1">#(__del__ does not always seem to get called on termination)</span>
            <span class="k">def</span> <span class="nf">exitfn</span><span class="p">(</span><span class="n">vref</span><span class="p">):</span>
                <span class="c1">#Check if the viewer reference is still valid</span>
                <span class="n">viewer</span> <span class="o">=</span> <span class="n">vref</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">viewer</span><span class="p">:</span>
                    <span class="n">viewer</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
            <span class="kn">import</span> <span class="nn">atexit</span>
            <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">exitfn</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>
            <span class="c1">#self.app = _LavaVuThreadSafe(binpath, havecontext, omegalib)</span>
            <span class="k">def</span> <span class="nf">_thread_run</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                This function runs the render thread.</span>
<span class="sd">                Used to: create the viewer, handle events, get images</span>
<span class="sd">                All OpenGL calls must be made from here</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="c1">#Create the viewer</span>
                <span class="n">viewer</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">binpath</span><span class="p">,</span> <span class="n">havecontext</span><span class="p">,</span> <span class="n">omegalib</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="c1">#Sync with main thread here to ensure render thread has initialised before it continues</span>
                <span class="k">with</span> <span class="n">viewer</span><span class="o">.</span><span class="n">_cv</span><span class="p">:</span>
                    <span class="n">viewer</span><span class="o">.</span><span class="n">_cv</span><span class="o">.</span><span class="n">notifyAll</span><span class="p">()</span>

                <span class="c1">#Handle events</span>
                <span class="n">viewer</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">_thread_run</span><span class="p">()</span>

                <span class="c1">#Closedown/delete must be called from thread to free OpenGL resources!</span>
                <span class="n">viewer</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">viewer</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="kn">import</span> <span class="nn">gc</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

            <span class="c1">#Thread start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_thread_run</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
            <span class="c1">#Due to python failing to call __del__ on exit, have to use daemon or thread never quits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1">#Start the thread and wait for it to finish initialising</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cv</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

            <span class="c1">#Start the web server</span>
            <span class="kn">import</span> <span class="nn">server</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">ipv6</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#ipv6 flag pass through?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">binpath</span><span class="p">,</span> <span class="n">havecontext</span><span class="p">,</span> <span class="n">omegalib</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="p">,</span> <span class="n">binpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">havecontext</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">omegalib</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and init the C++ viewer object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Get the binary path if not provided</span>
            <span class="k">if</span> <span class="n">binpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">binpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">_LavaVuThreadSafe</span><span class="p">(</span><span class="n">threaded</span><span class="p">,</span> <span class="n">binpath</span><span class="p">,</span> <span class="n">havecontext</span><span class="p">,</span> <span class="n">omegalib</span><span class="p">)</span>

            <span class="c1">#Get property dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">_convert_keys</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">propertyList</span><span class="p">()))</span>
            <span class="c1">#Init prop dict for tab completion</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Viewer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1">#Control setup, expect html files in same path as viewer binary</span>
            <span class="n">control</span><span class="o">.</span><span class="n">htmlpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">htmlpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">binpath</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">)</span>
            <span class="n">control</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">propertyList</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">htmlpath</span><span class="p">):</span>
                <span class="n">control</span><span class="o">.</span><span class="n">htmlpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">htmlpath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t locate html dir, interactive view disabled&quot;</span><span class="p">)</span>

            <span class="c1">#Create a control factory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">_ControlFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1">#List of inline WebGL viewers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">webglviews</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1">#Get available commands</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmdcategories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">commandList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmds</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allcmds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmdcategories</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cmds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">commandList</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_allcmds</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

            <span class="c1">#Create command methods</span>
            <span class="n">selfdir</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1">#Functions on Viewer</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allcmds</span><span class="p">:</span>
                <span class="c1">#Check if a method exists already</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">selfdir</span><span class="p">:</span>
                    <span class="n">existing</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">existing</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">existing</span><span class="p">):</span>
                        <span class="c1">#Add the lavavu doc entry to the docstring</span>
                        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="k">if</span> <span class="n">existing</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s2">&quot;Wraps LavaVu&quot;</span> <span class="ow">in</span> <span class="n">existing</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span> <span class="k">continue</span> <span class="c1">#Already modified</span>
                            <span class="n">doc</span> <span class="o">+=</span> <span class="n">existing</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">----</span><span class="se">\n</span><span class="s1">Wraps LavaVu script command of the same name:</span><span class="se">\n</span><span class="s1"> &gt; **&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;**:</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="n">doc</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">helpCommand</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="c1">#These should all be wrapper for the matching lavavu commands</span>
                        <span class="c1">#(Need to ensure we don&#39;t add methods that clash)</span>
                        <span class="n">existing</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#Use a closure to define a new method that runs this command</span>
                    <span class="k">def</span> <span class="nf">cmdmethod</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">_target</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1">#Use a weak ref in the closure</span>
                        <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                            <span class="n">arglist</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                                    <span class="n">arglist</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">arglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
                            <span class="n">_target</span><span class="p">()</span><span class="o">.</span><span class="n">commands</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arglist</span><span class="p">))</span>
                        <span class="k">return</span> <span class="n">method</span>

                    <span class="c1">#Create method that runs this command:</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">cmdmethod</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

                    <span class="c1">#Set docstring</span>
                    <span class="n">method</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">helpCommand</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="c1">#Add the new method</span>
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

            <span class="c1">#Add module functions to Viewer object</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>
            <span class="kn">import</span> <span class="nn">inspect</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>
                <span class="n">element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                    <span class="c1">#Add the new method</span>
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>

            <span class="c1">#Add object by geom type shortcut methods</span>
            <span class="c1">#(allows calling add by geometry type, eg: obj = lavavu.lines())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">renderers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;renderers&quot;</span><span class="p">][</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderers</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]:</span>
                <span class="c1">#Use a closure to define a new method to call addtype with this type</span>
                <span class="k">def</span> <span class="nf">addmethod</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                    <span class="n">_target</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1">#Use a weak ref in the closure</span>
                    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">_target</span><span class="p">()</span><span class="o">.</span><span class="n">_addtype</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">method</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">addmethod</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="c1">#Set docstring</span>
                <span class="n">method</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;Add a &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; visualisation object,</span><span class="se">\n</span><span class="s2">any data loaded into the object will be plotted as &quot;</span> <span class="o">+</span> <span class="n">key</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

            <span class="c1">#Switch the default background to white if in a browser notebook</span>
            <span class="k">if</span> <span class="n">is_notebook</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LavaVu Init error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Wait for the render thread to exit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="p">:</span>
            <span class="c1">#print(&quot;---SHUTDOWN-THREAD&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">_closing</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#Wait for server thread to exit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
            <span class="c1">#print(&quot;---SHUTDOWN-SERVER&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_closing</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#print(&quot;---DELETING&quot;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_managed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Using context manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_managed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Using context manager</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_managed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_getRendererType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the type index of a given renderer label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderers</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">geomtypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<div class="viewcode-block" id="Viewer.setup"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arglist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
         <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
         <span class="n">writeimage</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initscript</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">usequeue</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the viewer, initialising with provided arguments and</span>
<span class="sd">        entering event loop if requested</span>

<span class="sd">        Parameters: see __init__ docs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Convert options to args</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;default_args&quot;</span><span class="p">][:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">initscript</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-S&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-v&quot;</span><span class="p">]</span>
        <span class="c1">#Automation: scripted mode, no interaction</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">interactive</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-a&quot;</span><span class="p">]</span>
        <span class="c1">#Hidden window</span>
        <span class="k">if</span> <span class="n">hidden</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-h&quot;</span><span class="p">]</span>
        <span class="c1">#Timestep cache</span>
        <span class="k">if</span> <span class="n">cache</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-c1&quot;</span><span class="p">]</span>
        <span class="c1">#Subsample anti-aliasing for image output</span>
        <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-z&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">)]</span>
        <span class="c1">#Timestep range</span>
        <span class="k">if</span> <span class="n">timestep</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestep</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestep</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestep</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1">#Database file</span>
        <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">database</span><span class="p">]</span>
        <span class="c1">#Initial figure</span>
        <span class="k">if</span> <span class="n">figure</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">figure</span><span class="p">)]</span>
        <span class="c1">#Resolution</span>
        <span class="k">if</span> <span class="n">resolution</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
          <span class="c1">#Output res</span>
          <span class="c1">#args += [&quot;-x&quot; + str(resolution[0]) + &quot;,&quot; + str(resolution[1])]</span>
          <span class="c1">#Interactive res</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-r&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="c1">#Save image and quit</span>
        <span class="k">if</span> <span class="n">writeimage</span><span class="p">:</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;-I&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">script</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">script</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
          <span class="n">args</span> <span class="o">+=</span> <span class="n">script</span>
        <span class="k">if</span> <span class="n">arglist</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arglist</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">+=</span> <span class="n">arglist</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">arglist</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">usequeue</span>

        <span class="c1">#Additional keyword args as property settings</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])]</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ARGS:&quot;</span><span class="p">,</span><span class="n">args</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Need to call thread safe version if not in render thread</span>
            <span class="k">if</span> <span class="n">safe</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">saferun</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="c1">#Load objects/state</span>
            <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LavaVu Run error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">pass</span></div>



    <span class="c1">#dict methods</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1">#Get view/global property</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">view</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">view</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="c1">#Must always return a copy to prevent modifying the defaults!</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;default&quot;</span><span class="p">])</span> <span class="c1">#Default from prop list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="c1">#Set view/global property</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; : Invalid property name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">parseProperty</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="c1">#return &#39;{&quot;&#39; + self.state[&quot;properties&quot;][&quot;caption&quot;] + &#39;&quot;}&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1">#Necessary because being forced to inherit from dict to support buggy IPython key completion</span>
        <span class="c1">#means we get dict equality, which we _really_ don&#39;t want</span>
        <span class="c1">#Two Viewer objects should never be equal unless they refer to the same object</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#View/global props to string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return GL version string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gl_version</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">port</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        HTTP server interface port</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        port : int</span>
<span class="sd">            Port the HTTP server is running on</span>
<span class="sd">            Will return 0 if server is not running</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the active objects</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        objects : _Objects(dict)</span>
<span class="sd">            A dictionary wrapper containing the list of available visualisation objects</span>
<span class="sd">            Can be printed, iterated or accessed as a dictionary by object name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colourmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of active colourmaps</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        colourmaps : dict</span>
<span class="sd">            A dictionary containing the available colourmaps as ColourMap() wrapper objects</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;colourmaps&quot;</span><span class="p">]:</span>
            <span class="n">maps</span><span class="p">[</span><span class="n">cm</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ColourMap</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">maps</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">figures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the saved figures from loaded model</span>
<span class="sd">        Dict returned contains Fig objects which can be used to modify the figure</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        figures : dict</span>
<span class="sd">            A dictionary of all available figures by name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">amodel</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">figs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">amodel</span><span class="o">.</span><span class="n">fignames</span>
        <span class="n">figures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figs</span><span class="p">:</span>
            <span class="n">figures</span><span class="p">[</span><span class="n">fig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">figures</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the time step data from loaded model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        timesteps : list</span>
<span class="sd">            A list of all available time steps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">()</span>

<div class="viewcode-block" id="Viewer.Figure"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.Figure">[docs]</a>    <span class="k">def</span> <span class="nf">Figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the figure</span>
<span class="sd">        objects : list</span>
<span class="sd">            List of objects or object names to include in the figure, others will be hidden</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        figure : Figure</span>
<span class="sd">            Figure object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Show only objects in list</span>
        <span class="k">if</span> <span class="n">objects</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1">#Hide all first</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">o</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1">#Show by name or Object</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">:</span>
                        <span class="n">o</span><span class="p">[</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
                        <span class="n">o</span><span class="p">[</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">#Create a new figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefigure</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c1">#Sync list</span>
        <span class="n">figs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figures</span>
        <span class="c1">#Get figure wrapper object</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="c1">#Additional keyword args = properties</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="c1">#Return figure</span>
        <span class="k">return</span> <span class="n">fig</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">        step : int</span>
<span class="sd">            Returns current timestep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span>

    <span class="nd">@step</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">        step : int</span>
<span class="sd">            Sets current timestep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Import state from lavavu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">_convert_keys</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getState</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">_sync</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Export state to lavavu</span>
        <span class="c1">#(include current object list state)</span>
        <span class="c1">#self.state[&quot;objects&quot;] = [obj.dict for obj in self._objects.list]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">))</span>

<div class="viewcode-block" id="Viewer.commands"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.commands">[docs]</a>    <span class="k">def</span> <span class="nf">commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmds</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute viewer commands</span>
<span class="sd">        https://github.com/OKaluza/LavaVu/wiki/Scripting-Commands-Reference</span>
<span class="sd">        These commands can also be executed individually by calling them as methods of the viewer object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmds : list or str</span>
<span class="sd">            Command(s) to execute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmds</span><span class="p">):</span> <span class="k">return</span>
        <span class="c1">#Split multiple entries</span>
        <span class="k">if</span> <span class="s1">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">cmds</span><span class="p">:</span>
           <span class="n">cmds</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmds</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cmds</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span>

        <span class="c1">#JSON state?</span>
        <span class="k">if</span> <span class="n">cmds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span>
            <span class="c1">#self.app.setState(str(cmds.decode(&#39;ascii&#39;)))</span>
        <span class="k">elif</span> <span class="n">queue</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span> <span class="c1">#Thread safe queue requested</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">queueCommands</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span>
            <span class="c1">#self.app.qcommands(cmds)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">commands</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.help"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get help on a command or property</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmd : str</span>
<span class="sd">            Command to get help with, if ommitted displays general introductory help</span>
<span class="sd">            If cmd is a property or is preceded with &#39;@&#39; will display property help</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">md</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
            <span class="n">md</span> <span class="o">+=</span> <span class="n">_docmd</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)):</span>
            <span class="n">md</span> <span class="o">=</span> <span class="s1">&#39;### &#39;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s1">&#39;  </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">md</span> <span class="o">+=</span> <span class="n">_docmd</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;@&#39;</span><span class="p">:</span> <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">cmd</span>
            <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">helpCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">_markdown</span><span class="p">(</span><span class="n">md</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.__call__"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a LavaVu script</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmds : str</span>
<span class="sd">            String containing commands to run, separate commands with semi-colons&quot;</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; lv(&#39;reset; translate -2&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">(</span><span class="n">cmds</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setupobject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Strip data keys from kwargs and put aside for loading</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cmapdata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="s2">&quot;normals&quot;</span><span class="p">,</span> <span class="s2">&quot;vectors&quot;</span><span class="p">,</span> <span class="s2">&quot;colours&quot;</span><span class="p">,</span> <span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">]:</span>
                <span class="n">datasets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;colourmap&quot;</span><span class="p">:</span>
                <span class="n">cmapdata</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1">#Call function to add/setup the object, all other args passed to properties dict</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">createObject</span><span class="p">(</span><span class="n">_convert_args</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setObject</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">_convert_args</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="c1">#Get the created/updated object</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="c1">#Read any property data sets (allows object creation and load with single prop dict)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="c1">#Get the load function matching the data set (eg: vertices() ) and call on data</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">func</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1">#Set the colourmap, so python colourmap setting features can be used</span>
        <span class="k">if</span> <span class="n">cmapdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">colourmap</span><span class="p">(</span><span class="n">cmapdata</span><span class="p">)</span>

        <span class="c1">#Return wrapper obj</span>
        <span class="k">return</span> <span class="n">obj</span>

<div class="viewcode-block" id="Viewer.add"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a visualisation object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name to apply to the created object</span>
<span class="sd">            If an object of this name exists, it will be returned instead of created</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : Object</span>
<span class="sd">            The object created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">,</span> <span class="n">_Objects</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object exists: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1">#Put provided name in properties</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1">#Adds a new object, all other args passed to properties dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setupobject</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1">#Shortcut for adding specific geometry types</span>
    <span class="k">def</span> <span class="nf">_addtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Set name to typename if none provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_ctr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">typename</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ctr</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typename</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Viewer.Object"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.Object">[docs]</a>    <span class="k">def</span> <span class="nf">Object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or create a visualisation object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        identifier : str or int or Object, optional</span>
<span class="sd">            If a string, lookup an object by name</span>
<span class="sd">            If a number, lookup object by index</span>
<span class="sd">            If an object reference, lookup the Object by reference</span>
<span class="sd">            If omitted, return the last object in the list</span>
<span class="sd">            If no matching object found and string identifier provided, creates an empty object</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Set of properties passed to the object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : Object</span>
<span class="sd">            The object located/created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Return object by name/ref or last in list if none provided</span>
        <span class="c1">#Get state and update object list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: No objects exist!&quot;</span><span class="p">)</span>
        <span class="c1">#If name passed, find this object in updated list, if not just use the last</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">identifier</span><span class="p">:</span>
                    <span class="n">o</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="k">break</span>
            <span class="c1">#Not found? Create</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">o</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1">#Lookup by index</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">identifier</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">identifier</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">DrawingObject</span><span class="p">):</span>
            <span class="c1">#Lookup by swig wrapped object</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
                <span class="c1">#Can&#39;t compare swig wrapper objects directly,</span>
                <span class="c1">#so use the name</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">identifier</span><span class="o">.</span><span class="n">name</span><span class="p">():</span>
                    <span class="n">o</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Last resort: last object in list</span>
            <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setObject</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">_convert_args</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">o</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Object not found and could not be created: &quot;</span><span class="p">,</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Viewer.ColourMap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.ColourMap">[docs]</a>    <span class="k">def</span> <span class="nf">ColourMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or create a colourmap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        identifier : str or int or Object, optional</span>
<span class="sd">            If a string, lookup an object by name</span>
<span class="sd">            If a number, lookup object by index</span>
<span class="sd">            If an object reference, lookup the Object by reference</span>
<span class="sd">            If omitted, return the last object in the list</span>
<span class="sd">            If no matching object found and string identifier provided, creates an empty object</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Set of properties passed to the object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : Object</span>
<span class="sd">            The object located</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Viewer.file"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.file">[docs]</a>    <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a database or model file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to load</span>
<span class="sd">        obj : Object</span>
<span class="sd">            Vis object to load the file data into,</span>
<span class="sd">            if not provided a default will be created</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Load a new object from file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1">#Get last object added if none provided</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Object</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;json&quot;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;script&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: No objects exist after file load: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1">#Setups up new object, all other args passed to properties dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setupobject</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Viewer.files"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.files">[docs]</a>    <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load data from a series of files (using wildcards or a list)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        files : str</span>
<span class="sd">            Specification of the files to load, either a list of full paths or a file spec string such as `*.gldb`</span>
<span class="sd">        obj : Object</span>
<span class="sd">            Vis object to load the data into, if not provided a default will be created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Load list of files with glob</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="n">files</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="Viewer.colourbar"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.colourbar">[docs]</a>    <span class="k">def</span> <span class="nf">colourbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new colourbar</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Object, optional</span>
<span class="sd">            Vis object the colour bar applies to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        colourbar : Object</span>
<span class="sd">            The colourbar object created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Create a new colourbar</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">colourBar</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">colourBar</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ref</span><span class="p">:</span> <span class="k">return</span>
        <span class="c1">#Update list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span>
        <span class="c1">#Setups up new object, all other args passed to properties dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setupobject</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.defaultcolourmaps"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.defaultcolourmaps">[docs]</a>    <span class="k">def</span> <span class="nf">defaultcolourmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of default colour map names</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        colourmaps : list of str</span>
<span class="sd">            Names of all predefined colour maps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">LavaVuPython</span><span class="o">.</span><span class="n">ColourMap</span><span class="o">.</span><span class="n">getDefaultMapNames</span><span class="p">())</span></div>

<div class="viewcode-block" id="Viewer.defaultcolourmap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.defaultcolourmap">[docs]</a>    <span class="k">def</span> <span class="nf">defaultcolourmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get content of a default colour map</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the built in colourmap to return</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Colourmap data formatted as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">ColourMap</span><span class="o">.</span><span class="n">getDefaultMap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.colourmap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.colourmap">[docs]</a>    <span class="k">def</span> <span class="nf">colourmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">monochrome</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load or create a colour map</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the colourmap, if this colourmap name is found</span>
<span class="sd">            the data will replace the existing colourmap, otherwise</span>
<span class="sd">            a new colourmap will be created</span>
<span class="sd">        data : list or str</span>
<span class="sd">            Provided colourmap data can be</span>
<span class="sd">            - a string,</span>
<span class="sd">            - list of colour strings,</span>
<span class="sd">            - list of position,value tuples</span>
<span class="sd">            - or a built in colourmap name</span>
<span class="sd">            If none provided, a default colourmap will be loaded from lavavu.cubeHelix()</span>
<span class="sd">        reverse : boolean</span>
<span class="sd">            Reverse the order of the colours after loading</span>
<span class="sd">        monochrome : boolean</span>
<span class="sd">            Convert to greyscale</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ColourMap(dict)</span>
<span class="sd">            The wrapper object of the colourmap loaded/created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ColourMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">addColourMap</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cubeHelix</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">monochrome</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="Viewer.getcolourmap"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.getcolourmap">[docs]</a>    <span class="k">def</span> <span class="nf">getcolourmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapid</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return colour map data as a string or list</span>
<span class="sd">        Either return format can be used to create/modify a colourmap</span>
<span class="sd">        with colourmap()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mapid : str or int</span>
<span class="sd">            Name or index of the colourmap to retrieve</span>
<span class="sd">        string : boolean</span>
<span class="sd">            The default is to return the data as a string of colours separated by semi-colons</span>
<span class="sd">            To instead return a list of (position,[R,G,B,A]) tuples for easier automated processing in python,</span>
<span class="sd">            set this to False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mapdata : str or list</span>
<span class="sd">            The formatted colourmap data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ColourMap</span><span class="p">(</span><span class="n">mapid</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">string</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.clear"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colourmaps</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears all data from the visualisation</span>
<span class="sd">        Including objects and colourmaps by default</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objects : boolean</span>
<span class="sd">            including all objects, if set to False will clear the objects</span>
<span class="sd">            but not delete them</span>
<span class="sd">        colourmaps : boolean</span>
<span class="sd">            including all colourmaps</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">clearAll</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">colourmaps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span> <span class="c1">#Ensure in sync</span></div>

<div class="viewcode-block" id="Viewer.store"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;state.json&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store current visualisation state as a json file</span>
<span class="sd">        (Includes all properties, colourmaps and defined objects but not their geometry data)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to save</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state_file</span><span class="p">:</span>
            <span class="n">state_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getState</span><span class="p">())</span></div>

<div class="viewcode-block" id="Viewer.restore"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.restore">[docs]</a>    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;state.json&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore visualisation state from a json file</span>
<span class="sd">        (Includes all properties, colourmaps and defined objects but not their geometry data)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to load</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="n">state_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></div>

<div class="viewcode-block" id="Viewer.timesteps"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.timesteps">[docs]</a>    <span class="k">def</span> <span class="nf">timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the time step data from loaded model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        timesteps : list</span>
<span class="sd">            A list of all available time steps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_convert_keys</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getTimeSteps</span><span class="p">()))</span></div>

<div class="viewcode-block" id="Viewer.addstep"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.addstep">[docs]</a>    <span class="k">def</span> <span class="nf">addstep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new time step</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        step : int, optional</span>
<span class="sd">            Time step number, default is current + 1</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Timestep specific properties passed to the created object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">addTimeStep</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">_convert_args</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="Viewer.render"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Render a new frame, explicit display update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">display</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.init"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Re-initialise the viewer window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">isopen</span><span class="p">:</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">init</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.update"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write visualisation data back to the database</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filter : str</span>
<span class="sd">            Optional filter to type of geometry to be updated, if omitted all will be written</span>
<span class="sd">            (labels, points, grid, triangles, vectors, tracers, lines, shapes, volume)</span>
<span class="sd">        compress : boolean</span>
<span class="sd">            Use zlib compression when writing the geometry data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="c1">#Update object data at current timestep</span>
            <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#Re-writes all data to db for object</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">compress</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Re-writes data to db for object and geom type</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getRendererType</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="n">compress</span><span class="p">)</span>

        <span class="c1">#Update figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savefigure</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.image"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.image">[docs]</a>    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">95</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save or get an image of current display</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to save (should be .jpg or .png),</span>
<span class="sd">            if not provided the image will be returned as a base64 encoded data url</span>
<span class="sd">        resolution : list or tuple</span>
<span class="sd">            Image resolution in pixels [x,y]</span>
<span class="sd">        transparent : boolean</span>
<span class="sd">            Creates a PNG image with a transparent background</span>
<span class="sd">        quality : int</span>
<span class="sd">            Quality for JPEG image compression, default 95%</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        image : str</span>
<span class="sd">            filename of saved image or encoded image as string data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">transparent</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">quality</span><span class="p">,</span> <span class="n">transparent</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.frame"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.frame">[docs]</a>    <span class="k">def</span> <span class="nf">frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an image frame, returns current display as base64 encoded jpeg data url</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        resolution : list or tuple</span>
<span class="sd">            Image resolution in pixels [x,y]</span>
<span class="sd">        quality : int</span>
<span class="sd">            Quality for JPEG image compression, default 90%</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        image : str</span>
<span class="sd">            encoded image as string data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Jpeg encoded frame data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resolution</span><span class="p">:</span> <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">quality</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.jpeg"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.jpeg">[docs]</a>    <span class="k">def</span> <span class="nf">jpeg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an image frame, returns current display as JPEG data in a bytearray</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        resolution : list or tuple</span>
<span class="sd">            Image resolution in pixels [x,y]</span>
<span class="sd">        quality : int</span>
<span class="sd">            Quality for JPEG image compression, default 90%</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        image : bytearray</span>
<span class="sd">            encoded image as byte array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Jpeg encoded frame data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resolution</span><span class="p">:</span> <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">imageJPEG</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">quality</span><span class="p">))</span></div>

<div class="viewcode-block" id="Viewer.png"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.png">[docs]</a>    <span class="k">def</span> <span class="nf">png</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an image frame, returns current display as PNG data in a bytearray</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        resolution : list or tuple</span>
<span class="sd">            Image resolution in pixels [x,y]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        image : bytearray</span>
<span class="sd">            encoded image as byte array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#PNG encoded frame data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resolution</span><span class="p">:</span> <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">imagePNG</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Viewer.display"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.display">[docs]</a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Show the current display as inline image within an ipython notebook.</span>
<span class="sd">        </span>
<span class="sd">        If IPython is installed, displays the result image content inline</span>

<span class="sd">        If IPython is not installed, will save the result with </span>
<span class="sd">        a default filename in the current directory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        resolution : list or tuple</span>
<span class="sd">            Image resolution in pixels [x,y]</span>
<span class="sd">        transparent : boolean</span>
<span class="sd">            Creates a PNG image with a transparent background</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">Image</span><span class="p">,</span><span class="n">HTML</span>
            <span class="c1">#Return inline image result</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">transparent</span><span class="p">)</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;img src=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;&quot;</span> <span class="o">%</span> <span class="n">img</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Not in IPython, call default image save routines (autogenerated filenames)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">transparent</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.webgl"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.webgl">[docs]</a>    <span class="k">def</span> <span class="nf">webgl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;webgl.html&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span><span class="mi">480</span><span class="p">),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Create a WebGL page with a 3D interactive view of the active model</span>
<span class="sd">        </span>
<span class="sd">        Result is saved with default filename &quot;webgl.html&quot; in the current directory</span>

<span class="sd">        If running from IPython, displays the result WebGL content inline in an IFrame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Filename to save generated HTML page, default : webgl.html</span>
<span class="sd">        resolution : list or tuple</span>
<span class="sd">            Display window resolution in pixels [x,y]</span>
<span class="sd">        inline : boolean</span>
<span class="sd">            Display inline when in an IPython notebook cell, on by default.</span>
<span class="sd">            Set to false to open a full page viewer in a tab or new window</span>
<span class="sd">        menu : boolean</span>
<span class="sd">            Include and interactive menu for controlling visualisation appearance, on by default</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or obj</span>
<span class="sd">            filename as string if inline=False, or the inline object otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&lt;script id=&quot;data&quot; type=&quot;application/json&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">web</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&lt;/script&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">shaderpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">binpath</span><span class="p">,</span> <span class="s2">&quot;shaders&quot;</span><span class="p">)</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">_webglviewcode</span><span class="p">(</span><span class="n">shaderpath</span><span class="p">,</span> <span class="n">menu</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
            <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
                <span class="n">ID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">webglviews</span><span class="p">))</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">inlinehtml</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ID---&#39;</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---MENU---&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span> <span class="k">if</span> <span class="n">menu</span> <span class="k">else</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---HIDDEN---&#39;</span><span class="p">,</span> <span class="n">control</span><span class="o">.</span><span class="n">hiddenhtml</span><span class="p">)</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---WIDTH---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---HEIGHT---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">html</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---SCRIPTS---&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">webglviews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">basehtml</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---MENU---&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span> <span class="k">if</span> <span class="n">menu</span> <span class="k">else</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---HIDDEN---&#39;</span><span class="p">,</span> <span class="n">control</span><span class="o">.</span><span class="n">hiddenhtml</span><span class="p">)</span>
                <span class="n">html</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---SCRIPTS---&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.html&quot;</span>
                <span class="n">text_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
                <span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
                    <span class="c1">#from IPython.display import IFrame</span>
                    <span class="c1">#display(IFrame(filename, width=resolution[0], height=resolution[1]))</span>
                    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">HTML</span>
                    <span class="k">return</span> <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">webbrowser</span>
                    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># open in a new window if possible</span>
            <span class="k">return</span> <span class="n">filename</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WebGL output error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.video"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.video">[docs]</a>    <span class="k">def</span> <span class="nf">video</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Shows the generated video inline within an ipython notebook.</span>
<span class="sd">        </span>
<span class="sd">        If IPython is installed, displays the result video content inline</span>

<span class="sd">        If IPython is not installed, will save the result in the current directory</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to save, if not provided a default will be used</span>
<span class="sd">        fps : int</span>
<span class="sd">            Frames to output per second of video</span>
<span class="sd">        quality : int</span>
<span class="sd">            Encoding quality, 1=low(default), 2=medium, 3=high, higher quality reduces</span>
<span class="sd">            encoding artifacts at cost of larger file size</span>
<span class="sd">        resolution : list or tuple</span>
<span class="sd">            Video resolution in pixels [x,y]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">video</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">quality</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Video output error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.player"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.player">[docs]</a>    <span class="k">def</span> <span class="nf">player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows a video inline within an ipython notebook.</span>

<span class="sd">        If IPython is not running, just returns</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Path and name of the file to play</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">HTML</span>
                <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;video src=&quot;</span><span class="si">{fn}</span><span class="s2">&quot; controls loop&gt;</span>
<span class="s2">                Sorry, your browser doesn&#39;t support embedded videos, </span>
<span class="s2">                &lt;/video&gt;&lt;br&gt;</span>
<span class="s2">                &lt;a href=&quot;</span><span class="si">{fn}</span><span class="s2">&quot;&gt;Download Video&lt;/a&gt; </span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="c1">#Jupyterlab replaces ? with encoded char TODO: fix</span>
                <span class="c1">#Get a UUID based on host ID and current time</span>
                <span class="c1">#import uuid</span>
                <span class="c1">#uid = uuid.uuid1()</span>
                <span class="c1">#filename = filename + &quot;?&quot; + str(uid)</span>
                <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">filename</span><span class="p">)))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Video output error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Viewer.rawimage"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.rawimage">[docs]</a>    <span class="k">def</span> <span class="nf">rawimage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span> <span class="n">channels</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return raw image data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        resolution : tuple(int,int)</span>
<span class="sd">            Image width and height in pixels</span>
<span class="sd">        channels : int</span>
<span class="sd">            colour channels/depth in bytes (1=luminance, 3=RGB(default), 4=RGBA)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        image : array</span>
<span class="sd">            Numpy array of the image data requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">imageBuffer</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span></div>

<div class="viewcode-block" id="Viewer.testimages"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.testimages">[docs]</a>    <span class="k">def</span> <span class="nf">testimages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">TOL_DEFAULT</span><span class="p">,</span> <span class="n">expectedPath</span><span class="o">=</span><span class="s1">&#39;expected/&#39;</span><span class="p">,</span> <span class="n">outputPath</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare a list of images to expected images for testing</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imagelist : list</span>
<span class="sd">            List of test images to compare with expected results</span>
<span class="sd">            If not provided, will process all jpg and png images in working directory</span>
<span class="sd">        tolerance : float</span>
<span class="sd">            Tolerance level of difference before a comparison fails, default 0.0001</span>
<span class="sd">        expectedPath : str</span>
<span class="sd">            Where to find the expected result images (should have the same filenames as output images)</span>
<span class="sd">        outputPath : str</span>
<span class="sd">            Where to find the output images</span>
<span class="sd">        clear : boolean</span>
<span class="sd">            If the test passes the output images will be deleted, set to False to disable deletion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">expectedPath</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No expected data, copying found images to expected folder...&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">expectedPath</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">shutil</span> <span class="k">import</span> <span class="n">copyfile</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">imagelist</span><span class="p">:</span>
                <span class="c1">#Get all images in cwd</span>
                <span class="n">imagelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.png&quot;</span><span class="p">)</span>
                <span class="n">imagelist</span> <span class="o">+=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.jpg&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">imagelist</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">imagelist</span><span class="p">:</span>
                <span class="n">copyfile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expectedPath</span><span class="p">,</span> <span class="n">image</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">imagelist</span><span class="p">:</span>
            <span class="c1">#Default to all png images in expected dir</span>
            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">expectedPath</span><span class="p">)</span>
            <span class="n">imagelist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.png&quot;</span><span class="p">)</span>
            <span class="n">imagelist</span> <span class="o">+=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.jpg&quot;</span><span class="p">)</span>
            <span class="n">imagelist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">imagelist</span><span class="p">):</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">outputPath</span><span class="o">+</span><span class="n">f</span>
            <span class="n">expfile</span> <span class="o">=</span> <span class="n">expectedPath</span><span class="o">+</span><span class="n">f</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testimage</span><span class="p">(</span><span class="n">expfile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">))</span>

        <span class="c1">#Combined result</span>
        <span class="n">overallResult</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overallResult</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Image tests failed due to one or more image comparisons above tolerance level!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">imagelist</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------</span><span class="se">\n</span><span class="s2">Tests Passed!</span><span class="se">\n</span><span class="s2">-------------&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.testimage"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.testimage">[docs]</a>    <span class="k">def</span> <span class="nf">testimage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expfile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">TOL_DEFAULT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare two images</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expfile : str</span>
<span class="sd">            Expected result image</span>
<span class="sd">        outfile : str</span>
<span class="sd">            Test output image</span>
<span class="sd">        tolerance : float</span>
<span class="sd">            Tolerance level of difference before a comparison fails, default 0.0001</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : boolean</span>
<span class="sd">            True if test passes, difference &lt;= tolerance</span>
<span class="sd">            False if test fails, difference &gt; tolerance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">expfile</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test skipped, Reference image &#39;</span><span class="si">%s</span><span class="s2">&#39; not found!&quot;</span> <span class="o">%</span> <span class="n">expfile</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Generated image &#39;</span><span class="si">%s</span><span class="s2">&#39; not found!&quot;</span> <span class="o">%</span> <span class="n">outfile</span><span class="p">)</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">imageDiff</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">expfile</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">reset</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span>
        <span class="n">red</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[91m&#39;</span>
        <span class="n">green</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[92m&#39;</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="n">red</span> <span class="o">+</span> <span class="s1">&#39;FAIL&#39;</span> <span class="o">+</span> <span class="n">reset</span>
        <span class="n">passed</span> <span class="o">=</span> <span class="n">green</span> <span class="o">+</span> <span class="s1">&#39;PASS&#39;</span> <span class="o">+</span> <span class="n">reset</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> Image comp errors </span><span class="si">%f</span><span class="s2">, not&quot;</span>\
                  <span class="s2">&quot; within tolerance </span><span class="si">%g</span><span class="s2"> of reference image.&quot;</span>\
                <span class="o">%</span> <span class="p">(</span><span class="n">failed</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;echo_fails&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__________________________________________&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                        <span class="kn">import</span> <span class="nn">base64</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data:image/png;base64,&quot;</span> <span class="o">+</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Buffer:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__________________________________________&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> Image comp errors </span><span class="si">%f</span><span class="s2">, within tolerance </span><span class="si">%f</span><span class="s2">&quot;</span>\
                  <span class="s2">&quot; of ref image.&quot;</span>\
                <span class="o">%</span> <span class="p">(</span><span class="n">passed</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Viewer.window"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.window">[docs]</a>    <span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and display an interactive viewer instance</span>

<span class="sd">        This shows an active viewer window to the visualisation</span>
<span class="sd">        that can be controlled with the mouse or html widgets</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: support resolution set / full size of div, requires updating viewer frame size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Window</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.redisplay"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.redisplay">[docs]</a>    <span class="k">def</span> <span class="nf">redisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the display of any interactive viewer</span>

<span class="sd">        This is required after changing vis properties from python</span>
<span class="sd">        so the changes are reflected in the viewer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Issue redisplay to active viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">redisplay</span><span class="p">()</span></div>

<div class="viewcode-block" id="Viewer.camera"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.camera">[docs]</a>    <span class="k">def</span> <span class="nf">camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the current camera viewpoint</span>

<span class="sd">        Displays and returns camera in python form that can be pasted and</span>
<span class="sd">        executed to restore the same camera view</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : dict</span>
<span class="sd">            Camera view to apply if any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : dict</span>
<span class="sd">            Current camera view or previous if applying a new view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="n">me</span> <span class="o">=</span> <span class="n">_getVariableName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">me</span><span class="p">:</span> <span class="n">me</span> <span class="o">=</span> <span class="s2">&quot;lv&quot;</span>
        <span class="c1">#Also print in terminal for debugging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">(</span><span class="s2">&quot;camera&quot;</span><span class="p">)</span>
        <span class="c1">#Get: export from first view</span>
        <span class="n">vdat</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">def</span> <span class="nf">copyview</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;translate&quot;</span><span class="p">,</span> <span class="s2">&quot;rotate&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzrotate&quot;</span><span class="p">,</span> <span class="s2">&quot;aperture&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                        <span class="n">dst</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        <span class="c1">#Round down arrays to max 3 decimal places</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dst</span><span class="p">[</span><span class="n">key</span><span class="p">])):</span>
                                <span class="n">dst</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">dst</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">r</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="c1">#Not a list/array</span>
                            <span class="k">pass</span>

            <span class="n">copyview</span><span class="p">(</span><span class="n">vdat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">me</span> <span class="o">+</span> <span class="s2">&quot;.translation(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vdat</span><span class="p">[</span><span class="s2">&quot;translate&quot;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">me</span> <span class="o">+</span> <span class="s2">&quot;.rotation(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vdat</span><span class="p">[</span><span class="s2">&quot;xyzrotate&quot;</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

            <span class="c1">#Set</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">copyview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">()</span>

        <span class="c1">#Return</span>
        <span class="k">return</span> <span class="n">vdat</span></div>


<div class="viewcode-block" id="Viewer.getview"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.getview">[docs]</a>    <span class="k">def</span> <span class="nf">getview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get current view settings</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        view : str</span>
<span class="sd">            json string containing saved view settings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Viewer.setview"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.setview">[docs]</a>    <span class="k">def</span> <span class="nf">setview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set current view settings</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        view : str</span>
<span class="sd">            json string containing saved view settings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert_keys</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">view</span><span class="p">))</span></div>
        <span class="c1">#self._set() #? sync</span>

<div class="viewcode-block" id="Viewer.events"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.events">[docs]</a>    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process input events</span>
<span class="sd">        allows running interactive event loop while animating from python</span>
<span class="sd">        eg:</span>

<span class="sd">        &gt;&gt;&gt; while lv.events():</span>
<span class="sd">        &gt;&gt;&gt;     #...build next frame here...</span>
<span class="sd">        &gt;&gt;&gt;     lv.render()</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        boolean :</span>
<span class="sd">            False if user quit program, True otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">events</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="c1">#self.viewer.render()</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">quitProgram</span></div>

<div class="viewcode-block" id="Viewer.serve"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.serve">[docs]</a>    <span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a web server in python</span>
<span class="sd">        This uses server.py to launch a simple web server</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        port : int</span>
<span class="sd">            port to run on</span>
<span class="sd">        ipv6 : boolean</span>
<span class="sd">            use ipv6 if True, ipv4 if False</span>
<span class="sd">        retries : int</span>
<span class="sd">            Number of attempts to open a port, incrementing the port number each time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span> <span class="k">return</span>
        <span class="kn">import</span> <span class="nn">server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Viewer.browser"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.browser">[docs]</a>    <span class="k">def</span> <span class="nf">browser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open web server browser interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>
        <span class="c1">#Running outside IPython notebook? Join here to wait for quit</span>
        <span class="c1">#filename = &#39;http://localhost:&#39; + str(self.server.port) + &#39;/control.html&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/interactive.html&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_notebook</span><span class="p">():</span>
            <span class="kn">import</span> <span class="nn">webbrowser</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># open in a new window if possible</span>
        <span class="k">elif</span> <span class="n">inline</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">IFrame</span>
            <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
            <span class="n">display</span><span class="p">(</span><span class="n">IFrame</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">webbrowser</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># open in a new window if possible</span></div>

    <span class="k">def</span> <span class="nf">interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1">#Need to manually call show now</span>
        <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">(</span><span class="s2">&quot;interactive noloop&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">(</span><span class="s2">&quot;interactive&quot;</span><span class="p">)</span>

    <span class="c1">#TODO: TEST, on mac and with/without threading</span>
<div class="viewcode-block" id="Viewer.interact"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.interact">[docs]</a>    <span class="k">def</span> <span class="nf">interact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens an external interactive window</span>
<span class="sd">        Unless native=True is passed, will open an interactive web window</span>
<span class="sd">        for interactive control via web browser</span>

<span class="sd">        This starts an event handling loop which blocks python execution until the window is closed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        resolution : tuple(int,int)</span>
<span class="sd">            Window width and height in pixels, if not provided will use the global default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Start the server if not running</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
                <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">Javascript</span>
                <span class="n">js</span> <span class="o">=</span> <span class="s1">&#39;var win = window.open(&quot;http://localhost:</span><span class="si">{port}</span><span class="s1">/interactive.html&quot;, &quot;LavaVu&quot;, &quot;toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,width=</span><span class="si">{width}</span><span class="s1">,height=</span><span class="si">{height}</span><span class="s1">&quot;);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">display</span><span class="p">(</span><span class="n">Javascript</span><span class="p">(</span><span class="n">js</span><span class="p">))</span>
                <span class="c1">#Need a small delay to let the injected javascript popup run</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">webbrowser</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:</span><span class="si">{port}</span><span class="s2">/interactive.html&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
                <span class="c1">#webbrowser.open(url, new=1, autoraise=True) # open in a new window if possible</span>
                <span class="c1">#OPEN CONTROL TOO/INSTEAD?</span>
                <span class="c1">#url = &quot;http://localhost:{port}/control.html&quot;.format(port=self.server.port)</span>
                <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># open in a new window if possible</span>
                <span class="c1">#Handle events until quit - allow interaction without exiting when run from python script</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">quitProgram</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">TIMER_INC</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interactive launch error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">pass</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Allows use as thread safe functions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">isosurface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dstref</span><span class="p">,</span> <span class="n">srcref</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">clearvol</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">isoSurface</span><span class="p">(</span><span class="n">dstref</span><span class="p">,</span> <span class="n">srcref</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">clearvol</span><span class="p">)</span>
    <span class="c1">#def arrayFloat(self, ref, data, geomdtype):</span>
    <span class="c1">#    return self.app.arrayFloat(ref, data, geomdtype)</span>
    <span class="c1">#def arrayUInt(self, ref, data, geomdtype):</span>
    <span class="c1">#    return self.app.arrayUInt(ref, data, geomdtype)</span>
    <span class="c1">#def arrayUChar(self, ref, data, geomdtype):</span>
    <span class="c1">#    return self.app.arrayUChar(ref, data, geomdtype)</span>

<div class="viewcode-block" id="Viewer.get_all_vertices"><a class="viewcode-back" href="../../lavavu.html#lavavu.Viewer.get_all_vertices">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objectlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract all vertex data from a list of objects</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        pverts : array</span>
<span class="sd">            the vertices, numpy array</span>
<span class="sd">        bb_all : tuple</span>
<span class="sd">            the bounding box of the combined data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Get vertices from a list of lavavu objects</span>
        <span class="n">pverts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">bb_all</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;Inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;Inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;Inf&#39;</span><span class="p">)],</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-Inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-Inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-Inf&#39;</span><span class="p">)]]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objectlist</span><span class="p">:</span>
            <span class="c1">#Concatenate all elements</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">boundingbox</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bb_all</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">bb_all</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bb_all</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">bb_all</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
                <span class="n">pverts</span> <span class="o">=</span> <span class="n">v</span> <span class="k">if</span> <span class="n">pverts</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">pverts</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">pverts</span><span class="p">,</span> <span class="n">bb_all</span></div></div>


<span class="c1">#Wrapper for list of geomdata objects</span>
<div class="viewcode-block" id="Geometry"><a class="viewcode-back" href="../../lavavu.html#lavavu.Geometry">[docs]</a><span class="k">class</span> <span class="nc">Geometry</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    The Geometry class provides an interface to a drawing object&#39;s internal data</span>
<span class="sd">    Geometry instances are created internally in the Object class with the data property</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        </span>
<span class="sd">    Get all object data</span>

<span class="sd">    &gt;&gt;&gt; data = obj.data</span>
<span class="sd">    </span>
<span class="sd">    Get only triangle data</span>

<span class="sd">    &gt;&gt;&gt; data = obj.data[&quot;triangles&quot;]</span>

<span class="sd">    Get data at specific timestep only</span>
<span class="sd">    (default is current step including fixed data)</span>

<span class="sd">    &gt;&gt;&gt; data = obj.data[&quot;0&quot;]</span>

<span class="sd">    Loop through data</span>

<span class="sd">    &gt;&gt;&gt; for el in obj.data:</span>
<span class="sd">    &gt;&gt;&gt;     print(el)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">timestep</span>
        <span class="c1">#Get a list of geometry data objects for a given drawing object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">glist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getGeometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">glist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">getGeometryAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">datasets</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">glist</span><span class="p">:</span>
            <span class="c1">#By default all elements are returned, even if object has multiple types </span>
            <span class="c1">#Filter can be set to a type name to exclude other geometry types</span>
            <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_getRendererType</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">DrawData</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                <span class="c1">#Add the value data set labels</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">available</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>

        <span class="c1">#Allows getting data by data type or value labels using Descriptors</span>
        <span class="c1">#Data by type name</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">datatypes</span><span class="p">:</span>
            <span class="n">typename</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span>
                <span class="c1">#Just use the first available value label as the default .values descriptor</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">typename</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#Access by type name to get a view</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">Geometry</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_GeomDataListView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">typename</span><span class="p">))</span>
            <span class="c1">#Access by type name + _copy to get a copy</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">Geometry</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_copy&#39;</span><span class="p">,</span> <span class="n">_GeomDataListView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">typename</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1">#Data by label</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">Geometry</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_GeomDataListView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1">#Return data filtered by renderer type</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">geomnames</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="c1">#Or data filtered by timestep if a string timestep number passed</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Geometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">ts</span><span class="p">)</span>
            <span class="c1">#Or data by type/label</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#For backwards compatibility with old Viewer.data() method (now a property)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<span class="k">class</span> <span class="nc">_GeomDataListView</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A descriptor that provides view/copy/set access to a DrawData list&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span> <span class="o">=</span> <span class="n">copy</span>

        <span class="c1">#Set docstring</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;Get a copy of all &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; data from visualisation object&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;Get a view of all &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; data from visualisation object&quot;</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="c1"># we get here when someone calls x.d, and d is a GeomDataListView instance</span>
        <span class="c1"># instance = x</span>
        <span class="c1"># owner = type(x)</span>

        <span class="c1">#Return a copy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">]</span>
        <span class="c1">#Return a view</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># we get here when someone calls x.d = val, and d is a GeomDataListView instance</span>
        <span class="c1"># instance = x</span>
        <span class="c1"># value = val</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide a list of value arrays for each entry, </span><span class="si">%d</span><span class="s2"> entries&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
        <span class="c1">#Set each DrawData entry to corrosponding value list entry</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">v</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1">#Wrapper class for GeomData geometry object</span>
<div class="viewcode-block" id="DrawData"><a class="viewcode-back" href="../../lavavu.html#lavavu.DrawData">[docs]</a><span class="k">class</span> <span class="nc">DrawData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    The DrawData class provides an interface to a single object data element</span>
<span class="sd">    DrawData instances are created internally from the Geometry class</span>

<span class="sd">    copy(), get() and set() methods provide access to the data types</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        </span>
<span class="sd">    Get the data elements</span>

<span class="sd">    &gt;&gt;&gt; print(obj.data)</span>
<span class="sd">    [GeomData(&quot;points&quot;)]</span>
<span class="sd">    </span>
<span class="sd">    Get a copy of the colours (if any)</span>

<span class="sd">    &gt;&gt;&gt; colours = obj.data.colours_copy</span>

<span class="sd">    Get a view of the vertex data</span>

<span class="sd">    &gt;&gt;&gt; verts = obj.data.vertices</span>

<span class="sd">    WARNING: this reference may be deleted by other calls, </span>
<span class="sd">    use _copy if you are not processing the data immediately </span>
<span class="sd">    and relying on it continuing to exist later</span>

<span class="sd">    Get a some value data by label &quot;myvals&quot;</span>
<span class="sd">    &gt;&gt;&gt; vals = obj.data.myvals</span>
<span class="sd">    &gt;&gt;&gt; print(vals)</span>
<span class="sd">    [array([...])]</span>

<span class="sd">    Load some new values for this data, provided list must match first dimension of existing data list</span>

<span class="sd">    &gt;&gt;&gt; obj.data.myvals = [newdata]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#Get available data types</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">datatypes</span><span class="p">:</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">()</span>

<div class="viewcode-block" id="DrawData.get"><a class="viewcode-back" href="../../lavavu.html#lavavu.DrawData.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a data element from geometry data</span>

<span class="sd">        Warning... other than for internal use, should always</span>
<span class="sd">        immediately make copies of the data</span>
<span class="sd">        there is no guarantee memory will not be released!</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typename : str</span>
<span class="sd">            Type of data to be retrieved</span>
<span class="sd">            (vertices/normals/vectors/indices/colours/texcoords/luminance/rgb/values)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : array</span>
<span class="sd">            Numpy array view of the data set requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">array</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">typename</span> <span class="ow">in</span> <span class="n">datatypes</span> <span class="ow">and</span> <span class="n">typename</span> <span class="o">!=</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">typename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;luminance&quot;</span><span class="p">,</span> <span class="s2">&quot;rgb&quot;</span><span class="p">]:</span>
                <span class="c1">#Get uint8 data</span>
                <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayViewUChar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">datatypes</span><span class="p">[</span><span class="n">typename</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">typename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="s2">&quot;colours&quot;</span><span class="p">]:</span>
                <span class="c1">#Get uint32 data</span>
                <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayViewUInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">datatypes</span><span class="p">[</span><span class="n">typename</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Get float32 data</span>
                <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayViewFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">datatypes</span><span class="p">[</span><span class="n">typename</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Get float32 data</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayViewFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">typename</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">array</span></div>

<div class="viewcode-block" id="DrawData.copy"><a class="viewcode-back" href="../../lavavu.html#lavavu.DrawData.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a copy of a data element from geometry data</span>

<span class="sd">        This is a safe version of get() that copies the data</span>
<span class="sd">        before returning so can be assured it will remain valid</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typename : str</span>
<span class="sd">            Type of data to be retrieved</span>
<span class="sd">            (vertices/normals/vectors/indices/colours/texcoords/luminance/rgb/values)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : array</span>
<span class="sd">            Numpy array containing a copy of the data set requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Safer data access, makes a copy to ensure we still have access </span>
        <span class="c1">#to the data no matter what viewer does with it</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">typename</span><span class="p">))</span></div>

<div class="viewcode-block" id="DrawData.set"><a class="viewcode-back" href="../../lavavu.html#lavavu.DrawData.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typename</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a data element in geometry data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typename : str</span>
<span class="sd">            Type of data to set</span>
<span class="sd">            (vertices/normals/vectors/indices/colours/texcoords/luminance/rgb/values)</span>
<span class="sd">        array : array</span>
<span class="sd">            Numpy array holding the data to be written</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">typename</span> <span class="ow">in</span> <span class="n">datatypes</span> <span class="ow">and</span> <span class="n">typename</span> <span class="o">!=</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">typename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;luminance&quot;</span><span class="p">,</span> <span class="s2">&quot;rgb&quot;</span><span class="p">]:</span>
                <span class="c1">#Set uint8 data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayUInt8</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">datatypes</span><span class="p">[</span><span class="n">typename</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">typename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="s2">&quot;colours&quot;</span><span class="p">]:</span>
                <span class="c1">#Set uint32 data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayUInt32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span> <span class="n">datatypes</span><span class="p">[</span><span class="n">typename</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Set float32 data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">datatypes</span><span class="p">[</span><span class="n">typename</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Set float32 data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometryArrayFloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">typename</span><span class="p">)</span></div>
        
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">renderlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">geomnames</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geomtypes</span> <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;GeomData(&quot;&#39;</span> <span class="o">+</span> <span class="n">r</span> <span class="o">+</span> <span class="s1">&#39;&quot;)&#39;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">renderlist</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; ==&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">)</span></div>

<span class="c1">#Wrapper class for raw image data</span>
<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../lavavu.html#lavavu.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">    The Image class provides an interface to a raw image</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        </span>
<span class="sd">    &gt;&gt;&gt; img = lv.rawimage()</span>
<span class="sd">    &gt;&gt;&gt; img.write(&#39;out.png&#39;)</span>
<span class="sd">    </span>
<span class="sd">    TODO: expose image loading functions, custom blend equations</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span> <span class="n">channels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="n">value</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="n">value</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">fill</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">channels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

<div class="viewcode-block" id="Image.paste"><a class="viewcode-back" href="../../lavavu.html#lavavu.Image.paste">[docs]</a>    <span class="k">def</span> <span class="nf">paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span><span class="mi">480</span><span class="p">),</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render another image to a specified position with this image</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        source : array or lavavu.Viewer</span>
<span class="sd">            Numpy array containing raw image data to paste or a Viewer instance to source the frame from</span>
<span class="sd">        resolution : tuple(int,int)</span>
<span class="sd">            Sub-image width and height in pixels, if not provided source must be a numpy array of the correct dimensions</span>
<span class="sd">        position : tuple(int,int)</span>
<span class="sd">            Sub-image x,y offset in pixels</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">rawimage</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">data</span>

        <span class="n">resolution</span> <span class="o">=</span> <span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dest</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Base image too small for operation!&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &lt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dest</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Base image and pasted image must have same bit depth!&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &lt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">dest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">dest</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">source</span></div>

<div class="viewcode-block" id="Image.blend"><a class="viewcode-back" href="../../lavavu.html#lavavu.Image.blend">[docs]</a>    <span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span><span class="mi">480</span><span class="p">),</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render another image to a specified position with this image with alpha blending</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        source : array or lavavu.Viewer</span>
<span class="sd">            Numpy array containing raw image data to paste or a Viewer instance to source the frame from</span>
<span class="sd">        resolution : tuple(int,int)</span>
<span class="sd">            Sub-image width and height in pixels, if not provided source must be a numpy array of the correct dimensions</span>
<span class="sd">        position : tuple(int,int)</span>
<span class="sd">            Sub-image x,y offset in pixels</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">rawimage</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">data</span>

        <span class="n">channels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">blend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Require alpha channel to blend&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#Alpha blending, assumes not premultiplied alpha</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">srcalpha</span> <span class="o">=</span> <span class="n">src</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="n">dstalpha</span> <span class="o">=</span> <span class="n">dst</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.0</span>
        <span class="n">outalpha</span> <span class="o">=</span> <span class="n">srcalpha</span> <span class="o">+</span> <span class="n">dstalpha</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">srcalpha</span><span class="p">)</span>
        <span class="c1">#Ignore divide by zero if outalpha is zero</span>
        <span class="k">with</span> <span class="n">numpy</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="c1">#Premultiplied blend:</span>
                <span class="c1">#dst[:, :, c] = src[:, :, c] + dst[:, :, c] * (1.0 - srcalpha)</span>
                <span class="c1">#Not premultiplied: premultiply, then blend</span>
                <span class="n">src</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">*=</span> <span class="n">srcalpha</span>
                <span class="n">dst</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">*=</span> <span class="n">dstalpha</span>
                <span class="n">dst</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="n">dst</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">srcalpha</span><span class="p">))</span> <span class="o">/</span> <span class="n">outalpha</span>
        <span class="n">dst</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">outalpha</span> <span class="o">*</span> <span class="mi">255</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span></div>
        <span class="c1">#self.data[position[1]:dest[0], position[0]:dest[1]] = dst</span>

<div class="viewcode-block" id="Image.save"><a class="viewcode-back" href="../../lavavu.html#lavavu.Image.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a raw image data to provided filename</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Output filename (png/jpg supported, default is png if no extension)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to the output image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LavaVuPython</span><span class="o">.</span><span class="n">rawImageWrite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.display"><a class="viewcode-back" href="../../lavavu.html#lavavu.Image.display">[docs]</a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Show the image as inline image within an ipython notebook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">Image</span><span class="p">,</span><span class="n">HTML</span>
            <span class="c1">#Return inline image result</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;img src=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;&quot;</span> <span class="o">%</span> <span class="n">img</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="loadCPT"><a class="viewcode-back" href="../../lavavu.html#lavavu.loadCPT">[docs]</a><span class="k">def</span> <span class="nf">loadCPT</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a colourmap from a CPT colour table file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    positions : boolean</span>
<span class="sd">        Set this to false to ignore any positional data and</span>
<span class="sd">        load only the colours from the file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colours : string</span>
<span class="sd">        Colour string ready to be loaded by colourmap()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colours</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hexcolours</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hsv</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">hinge</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">addColour</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">colour</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">==</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">colour</span> <span class="o">==</span> <span class="n">colours</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="c1">#Skip duplicates</span>
            <span class="n">val</span> <span class="o">+=</span> <span class="mf">0.001</span> <span class="c1">#Add a small increment</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colour</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">colour</span><span class="p">:</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="n">colour</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">colour</span><span class="p">:</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="n">colour</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colour</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">hsv</span><span class="p">:</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">colour</span><span class="p">]</span>
                <span class="kn">import</span> <span class="nn">colorsys</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">360.0</span><span class="p">,</span><span class="n">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">colour</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">colour</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colour</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">colour</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colours</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">colour</span> <span class="o">!=</span> <span class="n">colours</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colour</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">hexcolours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colour</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hexcolours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#</span><span class="si">%02x%02x%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">colour</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="n">colours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colour</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cpt_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cpt_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;COLOR_MODEL&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;hsv&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">hsv</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;HINGE&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">hinge</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1">#RGB/HSV space separated?</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">addColour</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">])])</span>
                <span class="n">addColour</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">])])</span>
            <span class="c1">#Pass whole strings if / or - separated</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">addColour</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">addColour</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            


    <span class="n">minval</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">maxval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">vrange</span> <span class="o">=</span> <span class="n">maxval</span> <span class="o">-</span> <span class="n">minval</span>
    <span class="c1">#print &quot;HINGE: &quot;,hinge,&quot;MIN&quot;,minval,&quot;MAX&quot;,maxval</span>
    
    <span class="k">if</span> <span class="n">positions</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
            <span class="c1">#Centre hinge value</span>
            <span class="k">if</span> <span class="n">hinge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">hinge</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hinge</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">hinge</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">hinge</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">hinge</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="n">hinge</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span> <span class="o">/</span> <span class="n">vrange</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colours</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.5f</span><span class="s2">=</span><span class="si">%s</span><span class="s2">; &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">colours</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.5f</span><span class="s2">=rgb(</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">); &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">colours</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">colours</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">colours</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hexcolours</span><span class="p">)):</span>
            <span class="c1">#print &quot;(%f)%s&quot; % (values[v], hexcolours[v]),</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">hexcolours</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>

    <span class="k">return</span> <span class="n">result</span></div>

<span class="k">def</span> <span class="nf">_getVariableName</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to find the name of a variable from the main module namespace</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    var</span>
<span class="sd">        The variable in question</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of the variable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">__main__</span> <span class="k">as</span> <span class="nn">main_mod</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">main_mod</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">main_mod</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">var</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
    <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="printH5"><a class="viewcode-back" href="../../lavavu.html#lavavu.printH5">[docs]</a><span class="k">def</span> <span class="nf">printH5</span><span class="p">(</span><span class="n">h5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print info about HDF5 data set (requires h5py)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h5</span>
<span class="sd">        HDF5 Dataset loaded with h5py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------ &quot;</span><span class="p">,</span><span class="n">h5</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s2">&quot; ------&quot;</span><span class="p">)</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="n">h5</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">h5</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">h5</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">h5</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">item</span><span class="p">])</span></div>

<div class="viewcode-block" id="download"><a class="viewcode-back" href="../../lavavu.html#lavavu.download">[docs]</a><span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a file from an internet URL</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        URL to request the file from</span>
<span class="sd">    filename : str</span>
<span class="sd">        Filename to save, default is to keep the same name in current directory</span>
<span class="sd">    overwrite : boolean</span>
<span class="sd">        Always overwrite file if it exists, default is to never overwrite</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Actual filename written to local filesystem</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Python 3 moved urlretrieve to request submodule</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="k">import</span> <span class="n">urlretrieve</span>
        <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">urlparse</span>
        <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">quote</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">urlretrieve</span>
        <span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">quote</span>
        <span class="kn">from</span> <span class="nn">urlparse</span> <span class="k">import</span> <span class="n">urlparse</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="n">url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="c1">#Encode url path</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">quote</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot; exists, skipped downloading.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filename</span></div>

<div class="viewcode-block" id="style"><a class="viewcode-back" href="../../lavavu.html#lavavu.style">[docs]</a><span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="n">css</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inject stylesheet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_notebook</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">HTML</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;&quot;</span> <span class="o">+</span> <span class="n">css</span> <span class="o">+</span> <span class="s2">&quot;&lt;/style&gt;&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="cellstyle"><a class="viewcode-back" href="../../lavavu.html#lavavu.cellstyle">[docs]</a><span class="k">def</span> <span class="nf">cellstyle</span><span class="p">(</span><span class="n">css</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override the notebook cell styles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">style</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    div.container {{</span>
<span class="s2">        </span><span class="si">{css}</span><span class="s2"></span>
<span class="s2">    }}</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">))</span></div>

<div class="viewcode-block" id="cellwidth"><a class="viewcode-back" href="../../lavavu.html#lavavu.cellwidth">[docs]</a><span class="k">def</span> <span class="nf">cellwidth</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;99%&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override the notebook cell width</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cellstyle</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    width:</span><span class="si">{width}</span><span class="s2"> !important;</span>
<span class="s2">    margin-left:1%;</span>
<span class="s2">    margin-right:auto;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">))</span></div>

<span class="k">def</span> <span class="nf">_docmd</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a docstring to markdown&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">codeblock</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;```python&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;```&#39;</span><span class="p">]</span>
    <span class="n">md</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">code</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lastindent</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">indent</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="n">line</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">md</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">*</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="c1">#Replace &#39;-----&#39; heading underline with &#39;#### heading&quot;</span>
            <span class="n">md</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#### &quot;</span> <span class="o">+</span> <span class="n">md</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt; &#39;</span><span class="p">):</span>
            <span class="c1">#Python code</span>
            <span class="n">code</span> <span class="o">+=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">:]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Add code block</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
                <span class="n">md</span> <span class="o">+=</span> <span class="n">codeblock</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="n">code</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="ow">and</span> <span class="n">indent</span> <span class="o">==</span> <span class="n">lastindent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1">#Indented block, preserve indent</span>
                <span class="n">md</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span><span class="p">]</span>
                <span class="c1">#Keep indenting at this level until indent level changes</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">+=</span> <span class="p">[</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span><span class="p">]</span> <span class="c1">#Preserve line breaks</span>
        <span class="n">lastindent</span> <span class="o">=</span> <span class="n">indent</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
        <span class="n">md</span> <span class="o">+=</span> <span class="n">codeblock</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_markdown</span><span class="p">(</span><span class="n">mdstr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display markdown in IPython if available,</span>
<span class="sd">    otherwise just print it&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">Markdown</span>
        <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">mdstr</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Not in IPython, just print</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mdstr</span><span class="p">)</span>

<div class="viewcode-block" id="lerp"><a class="viewcode-back" href="../../lavavu.html#lavavu.lerp">[docs]</a><span class="k">def</span> <span class="nf">lerp</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Linear Interpolation between values of two lists</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    first : tuple or list</span>
<span class="sd">        first list of values</span>
<span class="sd">    second : tuple or list</span>
<span class="sd">        second list of values</span>
<span class="sd">    mu : float</span>
<span class="sd">        Interpolation factor [0,1]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        A list of the interpolated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">final</span> <span class="o">=</span> <span class="n">first</span><span class="p">[:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">second</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">first</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">final</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">mu</span>
    <span class="k">return</span> <span class="n">final</span></div>

<span class="c1">#Testing</span>
<span class="c1">#TODO: unit tests of all functions using code examples from docs, doctest</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">import unittest</span>

<span class="sd">def _strip_white_space(str):</span>
<span class="sd">    return str.replace(&quot; &quot;, &quot;&quot;).replace(&quot;\t&quot;, &quot;&quot;).replace(&quot;\n&quot;, &quot;&quot;)</span>

<span class="sd">class _TestLavaVu(unittest.TestCase):</span>

<span class="sd">    def setUp(self):</span>
<span class="sd">        self.lv = Viewer()</span>
<span class="sd">        pass</span>

<span class="sd">    def test_init(self):</span>
<span class="sd">        expected = &quot;&quot;&quot;</span>
<span class="sd">        caption=&quot;Test Pattern&quot;</span>
<span class="sd">        scale=[1.0, 1.0, 1.0]</span>
<span class="sd">        xyzrotate=[0.0, 0.0, 0.0]</span>
<span class="sd">        translate=[0.0, 0.0, -6.92820310592651]</span>
<span class="sd">        rotate=[0.0, 0.0, 0.0, 1.0]</span>
<span class="sd">        bounds={&quot;max&quot;: [2.0, 2.0, 2.0], &quot;min&quot;: [-2.0, -2.0, -2.0]}</span>
<span class="sd">        focus=[0.0, 0.0, 0.0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        self.lv.test()</span>
<span class="sd">        self.assertEqual(_strip_white_space(str(self.lv)), _strip_white_space(expected))</span>

<span class="sd">if __name__ == &#39;__main__&#39;:</span>
<span class="sd">    unittest.main()</span>
<span class="sd">    #import doctest</span>
<span class="sd">    #doctest.testmod()</span>

<span class="sd">if is_notebook():</span>
<span class="sd">    print(&quot;Loaded LavaVu v%s&quot; % version)</span>
<span class="sd">    print(&quot; - docs: https://github.com/OKaluza/LavaVu/wiki&quot;)</span>

<span class="sd">&#39;&#39;&#39;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LavaVu 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Monash University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>