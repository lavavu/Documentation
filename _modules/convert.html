
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>convert &#8212; LavaVu 1.3.2 documentation</title>
    <link rel="stylesheet" href="../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">LavaVu 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for convert</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Warning! EXPERIMENTAL:</span>
<span class="sd"> these features and functions are under development, will have bugs,</span>
<span class="sd"> and may be heavily modified in the future</span>

<span class="sd">Tools for converting between 3D data types</span>

<span class="sd">- Points to Volume</span>
<span class="sd">- Triangles to OBJ file</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">os</span>

<div class="viewcode-block" id="min_max_range"><a class="viewcode-back" href="../convert.html#convert.min_max_range">[docs]</a><span class="k">def</span> <span class="nf">min_max_range</span><span class="p">(</span><span class="n">verts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get bounding box from a list of vertices</span>
<span class="sd">    returns (min, max, range)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">vrange</span> <span class="o">=</span> <span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bounding box &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">),</span> <span class="s2">&quot;Range &quot;</span><span class="p">,</span> <span class="n">vrange</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vrange</span><span class="p">)</span></div>

<div class="viewcode-block" id="default_sample_grid"><a class="viewcode-back" href="../convert.html#convert.default_sample_grid">[docs]</a><span class="k">def</span> <span class="nf">default_sample_grid</span><span class="p">(</span><span class="n">vrange</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate sample grid fine enough to capture point details</span>
<span class="sd">    resolution of smallest dimension will be minres elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#If provided a full resolution, use that, otherwise will be interpreted as min res</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="c1">#Use bounding box range min</span>
    <span class="n">minr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vrange</span><span class="p">)</span>
    <span class="c1">#res parameter is minimum resolution</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">minr</span><span class="p">)</span>
    <span class="n">RES</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">factor</span><span class="o">*</span><span class="p">(</span><span class="n">vrange</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span><span class="n">factor</span><span class="o">*</span><span class="p">(</span><span class="n">vrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span><span class="n">factor</span><span class="o">*</span><span class="p">(</span><span class="n">vrange</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>   
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sample grid RES:&quot;</span><span class="p">,</span><span class="n">RES</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RES</span></div>

<div class="viewcode-block" id="points_to_volume"><a class="viewcode-back" href="../convert.html#convert.points_to_volume">[docs]</a><span class="k">def</span> <span class="nf">points_to_volume</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">kdtree</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundingbox</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert object vertices to a volume by interpolating points to a grid</span>

<span class="sd">    - Vertex data only is used, so treated as a point cloud</span>
<span class="sd">    - Can also be used to sample an irregular grid to a regular so volume render matches the grid dimensions</span>
<span class="sd">    - Result is a density field that can be volume rendered</span>

<span class="sd">    Default is to use numpy.histogramdd method, pass kdtree=True to use scipy.spatial.KDTree</span>

<span class="sd">    TODO: support colour data too, converted density field becomes alpha channel</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    values: numpy array of float32</span>
<span class="sd">        The converted density field</span>
<span class="sd">    vmin</span>
<span class="sd">        the minimum 3d vertex of the bounding box</span>
<span class="sd">    vmax</span>
<span class="sd">        the maximum 3d vertex of the bounding box</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">kdtree</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">points_to_volume_tree</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">points_to_volume_histogram</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">normed</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="n">boundingbox</span><span class="p">)</span></div>

<div class="viewcode-block" id="points_to_volume_histogram"><a class="viewcode-back" href="../convert.html#convert.points_to_volume_histogram">[docs]</a><span class="k">def</span> <span class="nf">points_to_volume_histogram</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundingbox</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Using numpy.histogramdd to create 3d histogram volume grid</span>
<span class="sd">    (Easily the fastest, but less control over output)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Reshape to 3d vertices</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1">#Get bounding box of swarm</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vrange</span> <span class="o">=</span> <span class="n">min_max_range</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

    <span class="c1">#Minimum resolution to get ok sampling</span>
    <span class="k">if</span> <span class="n">boundingbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">boundingbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">boundingbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">vrange</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boundingbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boundingbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">RES</span> <span class="o">=</span> <span class="n">default_sample_grid</span><span class="p">(</span><span class="n">vrange</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

    <span class="c1">#H, edges = numpy.histogramdd(verts, bins=RES)</span>
    <span class="k">if</span> <span class="n">boundingbox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">H</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogramdd</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">RES</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">)</span> <span class="c1">#density=True for newer numpy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rg</span> <span class="o">=</span> <span class="p">((</span><span class="n">vmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">vmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">vmin</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="c1">#provide bounding box as range</span>
        <span class="n">H</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogramdd</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">RES</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">rg</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">)</span> <span class="c1">#density=True for newer numpy</span>

    <span class="c1">#Reverse ordering X,Y,Z to Z,Y,X for volume data</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="c1">#Clamp [0,0.1] - optional (for a more binary output, points vs no points)</span>
    <span class="k">if</span> <span class="n">clamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="n">clamp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a_max</span><span class="o">=</span><span class="n">clamp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1">#Normalise [0,1] if using probability density</span>
    <span class="k">if</span> <span class="n">normed</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span></div>

<div class="viewcode-block" id="points_to_volume_tree"><a class="viewcode-back" href="../convert.html#convert.points_to_volume_tree">[docs]</a><span class="k">def</span> <span class="nf">points_to_volume_tree</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Using scipy.spatial.KDTree to find nearest points on grid</span>

<span class="sd">    - Much slower, but more control</span>
<span class="sd">    TODO: control parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Reshape to 3d vertices</span>
    <span class="n">verts</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1">#Get bounding box of swarm</span>
    <span class="n">lmin</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">lrange</span> <span class="o">=</span> <span class="n">min_max_range</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Volume bounds: &quot;</span><span class="p">,</span><span class="n">lmin</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">lmax</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">lrange</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    
    <span class="c1">#Push out the edges a bit, will create a smoother boundary when we filter</span>
    <span class="c1">#lmin -= 0.1*lrange</span>
    <span class="c1">#lmax += 0.1*lrange</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">verts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c1">#Minimum resolution to get ok sampling</span>
    <span class="n">RES</span> <span class="o">=</span> <span class="n">default_sample_grid</span><span class="p">(</span><span class="n">lrange</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

    <span class="c1">#Push out the edges a bit, will create a smoother boundary when we filter</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">lrange</span> <span class="o">/</span> <span class="n">RES</span> <span class="c1">#Cell size</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CELL:&quot;</span><span class="p">,</span><span class="n">cell</span><span class="p">)</span>
    <span class="n">lmin</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">cell</span>
    <span class="n">lmax</span> <span class="o">+=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">cell</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">RES</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="n">RES</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lmin</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">,</span> <span class="n">RES</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">Z</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span> <span class="c1">#ij=matrix indexing, xy=cartesian</span>
    <span class="n">XYZ</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">lmin</span><span class="p">,</span><span class="n">lmax</span><span class="p">,</span> <span class="n">XYZ</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1">#KDtree for finding nearest neighbour points</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">spatial</span>
    <span class="c1">#sys.setrecursionlimit(1000)</span>
    <span class="c1">#tree = spatial.KDTree(XYZ)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building KDTree&quot;</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">cKDTree</span><span class="p">(</span><span class="n">XYZ</span><span class="p">)</span>

    <span class="c1">#Outside distance to apply to grid points</span>
    <span class="n">MAXDIST</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lrange</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">RES</span><span class="p">)</span> <span class="c1">#Max cell size diagonal</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tree query, maxdist:&quot;</span><span class="p">,</span><span class="n">MAXDIST</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">lrange</span><span class="p">))</span>

    <span class="c1">#Query all points, result is tuple: distances, indices</span>
    <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#Just get a single nearest neighbour for now</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculate distances&quot;</span><span class="p">)</span>
    <span class="c1">#Convert distances to [0,1] where 1=on grid and &lt;= 0 is outside max range</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="p">(</span><span class="n">MAXDIST</span> <span class="o">-</span> <span class="n">distances</span><span class="p">)</span> <span class="o">/</span> <span class="n">MAXDIST</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Zero out of range distances&quot;</span><span class="p">)</span>
    <span class="n">distances</span> <span class="o">*=</span> <span class="p">(</span><span class="n">distances</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#Zero negative elements by multiplication in-place</span>

    <span class="c1">#Add the distances to the values at their nearest grid point indices</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Compose distance field&quot;</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">XYZ</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">+=</span> <span class="n">distances</span>
    <span class="c1">#Clip value max</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clip distance field&quot;</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    
    <span class="c1">#Reshape to actual grid dims Z,Y,X... (not required but allows slicing)</span>
    <span class="n">XYZ</span> <span class="o">=</span> <span class="n">XYZ</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">RES</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">RES</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">XYZ</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">lmin</span><span class="p">,</span> <span class="n">lmax</span><span class="p">)</span></div>


<div class="viewcode-block" id="points_to_volume_3D"><a class="viewcode-back" href="../convert.html#convert.points_to_volume_3D">[docs]</a><span class="k">def</span> <span class="nf">points_to_volume_3D</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">kdtree</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blur</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolate points to grid and load into passed volume object</span>

<span class="sd">    Given a list of objects and a volume object, convert a point cloud</span>
<span class="sd">    from another object (or objects - list is supported) into a volume using</span>
<span class="sd">    points_to_volume()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">parent</span> <span class="c1">#Get the viewer from passed object</span>
    <span class="n">lv</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span> <span class="c1">#Hide the converted objects</span>

    <span class="c1">#Get vertices from lavavu objects</span>
    <span class="n">pverts</span><span class="p">,</span> <span class="n">bb_all</span> <span class="o">=</span> <span class="n">lv</span><span class="o">.</span><span class="n">get_all_vertices</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span>

    <span class="c1">#blur = False</span>
    <span class="c1">#Use bounding box of full model?</span>
    <span class="c1">#vmin, vmax, vrange = min_max_range([lv[&quot;min&quot;], lv[&quot;max&quot;]])</span>
    <span class="c1">#bb_all == (vmin, vmax)</span>
    <span class="n">vdata</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">points_to_volume</span><span class="p">(</span><span class="n">pverts</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">kdtree</span><span class="p">,</span> <span class="n">normed</span><span class="p">,</span> <span class="n">clamp</span><span class="p">,</span> <span class="n">bb_all</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">blur</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filter/blur distance field&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">scipy.ndimage.filters</span> <span class="k">import</span> <span class="n">gaussian_filter</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">vdata</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#, mode=&#39;nearest&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">vdata</span> <span class="c1">#Need extra space at edges to use blur, so skip, or use pad() </span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    
    <span class="n">vol</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">vol</span><span class="o">.</span><span class="n">vertices</span><span class="p">((</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span></div>

<div class="viewcode-block" id="points_to_volume_4D"><a class="viewcode-back" href="../convert.html#convert.points_to_volume_4D">[docs]</a><span class="k">def</span> <span class="nf">points_to_volume_4D</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">kdtree</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blur</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolate points to grid at each timestep</span>

<span class="sd">    Given a list of objects and a volume object, convert a time-varying point cloud</span>
<span class="sd">    from another object (or objects - list is supported) into a volume using</span>
<span class="sd">    points_to_volume_3D()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">parent</span> <span class="c1">#Get the viewer from passed object</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">lv</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TIMESTEP:&quot;</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">timestep</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        
        <span class="n">points_to_volume_3D</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">kdtree</span><span class="p">,</span> <span class="n">blur</span><span class="p">,</span> <span class="n">normed</span><span class="p">,</span> <span class="n">clamp</span><span class="p">)</span></div>


<div class="viewcode-block" id="export_OBJ"><a class="viewcode-back" href="../convert.html#convert.export_OBJ">[docs]</a><span class="k">def</span> <span class="nf">export_OBJ</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export a given object to an OBJ file</span>
<span class="sd">    Supports only triangle mesh objects</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mtl_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">mtl_line2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmaptexcoords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;texture&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;colourmap&#39;</span><span class="p">:</span>
        <span class="c1">#Write palette.png</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">palette</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;texture&#39;</span><span class="p">)</span>
        <span class="n">mtl</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;# Create as many materials as desired</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;# Each is referenced by name before the faces it applies to in the obj file</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;newmtl material0</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Ka 1.000000 1.000000 1.000000</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Kd 1.000000 1.000000 1.000000</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Ks 0.000000 0.000000 0.000000</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Tr 1.000000</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;illum 1</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Ns 0.000000</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;map_Kd texture.png</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span> <span class="o">+</span> <span class="s1">&#39;.mtl&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mtl</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">mtl_line</span> <span class="o">=</span> <span class="s2">&quot;mtllib &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.mtl</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">mtl_line2</span> <span class="o">=</span> <span class="s2">&quot;usemtl material0</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# OBJ file</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1">#f.write(mtl_line)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] element </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">o</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">)))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;o Surface_</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">o</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mtl_line</span><span class="p">)</span> <span class="c1">#After this?</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No vertices&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">normals</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">normals</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">texcoords</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">texcoords</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="c1">#Calculate texcoords from colour values?</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">texcoords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;texture&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;colourmap&#39;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;colourby&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
                    <span class="c1">#Use the given label index</span>
                    <span class="n">sets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#Use the default label</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;values&#39;</span>
                <span class="n">valdata</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valdata</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">o</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1">#Found matching value array</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">valdata</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
                    <span class="c1">#Normalise [0,1]</span>
                    <span class="n">texcoords</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="c1">#Add 2nd dimension (not actually necessary,</span>
                    <span class="c1">#tex coords can by 1d but breaks some loaders (meshlab)</span>
                    <span class="n">zeros</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">texcoords</span><span class="p">)))</span>
                    <span class="n">texcoords</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">texcoords</span><span class="p">,</span><span class="n">zeros</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Writing vertices:&quot;</span><span class="p">,</span><span class="n">verts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">verts</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;v </span><span class="si">%.6f</span><span class="s2"> </span><span class="si">%.6f</span><span class="s2"> </span><span class="si">%.6f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Writing normals:&quot;</span><span class="p">,</span><span class="n">normals</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">normals</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;vn </span><span class="si">%.6f</span><span class="s2"> </span><span class="si">%.6f</span><span class="s2"> </span><span class="si">%.6f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Writing texcoords:&quot;</span><span class="p">,</span><span class="n">texcoords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">texcoords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">texcoords</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;vt </span><span class="si">%.6f</span><span class="s2"> </span><span class="si">%.6f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">texcoords</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;vt </span><span class="si">%.6f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>

            <span class="c1">#Face elements v/t/n v/t v//n</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mtl_line2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normals</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">texcoords</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Writing faces (v/t/n):&quot;</span><span class="p">,</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                    <span class="n">i0</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">i1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;f </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i2</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">texcoords</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Writing faces (v/t):&quot;</span><span class="p">,</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                    <span class="n">i0</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">i1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;f </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i2</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">normals</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Writing faces (v//n):&quot;</span><span class="p">,</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                    <span class="n">i0</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">i1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;f </span><span class="si">%d</span><span class="s2">//</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">//</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">//</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Writing faces (v):&quot;</span><span class="p">,</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;f </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span><span class="p">))</span>

            <span class="n">offset</span> <span class="o">+=</span> <span class="n">verts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">LavaVu 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Monash University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>