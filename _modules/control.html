
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>control &#8212; LavaVu 1.3.2 documentation</title>
    <link rel="stylesheet" href="../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">LavaVu 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for control</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">LavaVu python interface</span>

<span class="sd">Interactive HTML UI controls library</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">vutils</span> <span class="k">import</span> <span class="n">is_ipython</span><span class="p">,</span> <span class="n">is_notebook</span>
<span class="kn">import</span> <span class="nn">weakref</span>

<span class="c1">#Register of controls and their actions</span>
<span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#Register of windows (viewer instances)</span>
<span class="n">windows</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">vertexShader</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;script id=&quot;line-vs&quot; type=&quot;x-shader/x-vertex&quot;&gt;</span>
<span class="s2">precision highp float;</span>
<span class="s2">//Line vertex shader</span>
<span class="s2">attribute vec3 aVertexPosition;</span>
<span class="s2">attribute vec4 aVertexColour;</span>
<span class="s2">uniform mat4 uMVMatrix;</span>
<span class="s2">uniform mat4 uPMatrix;</span>
<span class="s2">uniform vec4 uColour;</span>
<span class="s2">varying vec4 vColour;</span>
<span class="s2">void main(void)</span>
<span class="s2">{</span>
<span class="s2">  vec4 mvPosition = uMVMatrix * vec4(aVertexPosition, 1.0);</span>
<span class="s2">  gl_Position = uPMatrix * mvPosition;</span>
<span class="s2">  vColour = uColour;</span>
<span class="s2">}</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">fragmentShader</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;script id=&quot;line-fs&quot; type=&quot;x-shader/x-fragment&quot;&gt;</span>
<span class="s2">precision highp float;</span>
<span class="s2">varying vec4 vColour;</span>
<span class="s2">void main(void)</span>
<span class="s2">{</span>
<span class="s2">  gl_FragColor = vColour;</span>
<span class="s2">}</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">basehtml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>

<span class="s2">&lt;head&gt;</span>
<span class="s2">&lt;title&gt;LavaVu Interface&lt;/title&gt;</span>
<span class="s2">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=ISO-8859-1&quot;&gt;</span>

<span class="s2">---SCRIPTS---</span>

<span class="s2">&lt;/head&gt;</span>

<span class="s2">&lt;body onload=&quot;initPage(null, ---MENU---);&quot; oncontextmenu=&quot;return false;&quot;&gt;</span>
<span class="s2">---HIDDEN---</span>
<span class="s2">&lt;/body&gt;</span>

<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">inlinehtml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">---SCRIPTS---</span>
<span class="s2">&lt;div id=&quot;---ID---&quot; style=&quot;display: block; width: ---WIDTH---px; height: ---HEIGHT---px;&quot;&gt;&lt;/div&gt;</span>
<span class="s2">---HIDDEN---</span>

<span class="s2">&lt;script&gt;</span>
<span class="s2">initPage(&quot;---ID---&quot;, ---MENU---);</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Some common elements (TODO: dynamically create these when not found)</span>
<span class="n">hiddenhtml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;div id=&quot;progress&quot; class=&quot;popup&quot; style=&quot;display: none; width: 310px; height: 32px;&quot;&gt;</span>
<span class="s2">  &lt;span id=&quot;progressmessage&quot;&gt;&lt;/span&gt;&lt;span id=&quot;progressstatus&quot;&gt;&lt;/span&gt;</span>
<span class="s2">  &lt;div id=&quot;progressbar&quot; style=&quot;width: 300px; height: 10px; background: #58f;&quot;&gt;&lt;/div&gt;</span>
<span class="s2">&lt;/div&gt;</span>

<span class="s2">&lt;div id=&quot;hidden&quot; style=&quot;display: none&quot;&gt;</span>
<span class="s2">  &lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAPCAYAAAA2yOUNAAAAj0lEQVQokWNIjHT8/+zZs//Pnj37/+TJk/9XLp/+f+bEwf9HDm79v2Prqv9aKrz/GUYVEaeoMDMQryJXayWIoi0bFmFV1NWS+z/E1/Q/AwMDA0NVcez/LRsWoSia2luOUAADVcWx/xfO6/1/5fLp/1N7y//HhlmhKoCBgoyA/w3Vyf8jgyyxK4CBUF8zDAUAAJRXY0G1eRgAAAAASUVORK5CYII=&quot; id=&quot;slider&quot;&gt;</span>
<span class="s2">  &lt;canvas id=&quot;gradient&quot; width=&quot;2048&quot; height=&quot;1&quot;&gt;&lt;/canvas&gt;</span>
<span class="s2">  &lt;canvas id=&quot;palette&quot; width=&quot;512&quot; height=&quot;24&quot; class=&quot;palette checkerboard&quot;&gt;&lt;/canvas&gt;</span>
<span class="s2">&lt;/div&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">#Property dict (str json) - set from lavavu</span>
<span class="n">dictionary</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span>

<span class="c1">#Static HTML location</span>
<span class="n">htmlpath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="k">def</span> <span class="nf">_isviewer</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return true if target is a viewer&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_getviewer</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return its viewer if target is vis object</span>
<span class="sd">    otherwise just return target as if is a viewer&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_isviewer</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">target</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">return</span> <span class="n">target</span>

<span class="k">def</span> <span class="nf">_getproperty</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">propname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return value of property from target</span>
<span class="sd">    if not defined, return the default value for this property</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_lv</span> <span class="o">=</span> <span class="n">_getviewer</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">propname</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target</span><span class="p">[</span><span class="n">propname</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">propname</span> <span class="ow">in</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
        <span class="c1">#Get property default</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="n">propname</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">_file_cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_webglcode</span><span class="p">(</span><span class="n">shaders</span><span class="p">,</span> <span class="n">css</span><span class="p">,</span> <span class="n">scripts</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lighttheme</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns base WebGL code, by default using full WebGL renderer (draw.js)</span>
<span class="sd">    Pass &#39;drawbox.js&#39; for box interactor only</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">shaders</span>
    <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
        <span class="n">scripts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;menu.js&#39;</span><span class="p">]</span>
        <span class="c1">#Following scripts need require disabled</span>
        <span class="n">scripts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;dat.gui.min.js&#39;</span><span class="p">]</span>
        <span class="c1">#Stats module for WebVR</span>
        <span class="k">if</span> <span class="n">stats</span><span class="p">:</span>
            <span class="n">scripts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;stats.min.js&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lighttheme</span><span class="p">:</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;dat-gui-light-theme.css&quot;</span><span class="p">)</span>
        <span class="c1">#Some css tweaks</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;gui.css&quot;</span><span class="p">)</span>

    <span class="c1">#First scripts list needs require.js disabled</span>
    <span class="n">code</span> <span class="o">+=</span> <span class="n">_getjslibs</span><span class="p">([</span><span class="s1">&#39;!REQUIRE_OFF&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">scripts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;!REQUIRE_ON&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">scripts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">code</span> <span class="o">+=</span> <span class="n">_getcss</span><span class="p">(</span><span class="n">css</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">+=</span> <span class="s1">&#39;&lt;script id=&quot;dictionary&quot; type=&quot;application/json&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">dictionary</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&lt;/script&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">code</span>

<span class="k">def</span> <span class="nf">_webglviewcode</span><span class="p">(</span><span class="n">shaderpath</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lighttheme</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns WebGL base code for an interactive visualisation window</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">jslibs</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;gl-matrix-min.js&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;OK-min.js&#39;</span><span class="p">,</span> <span class="s1">&#39;draw.js&#39;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">_webglcode</span><span class="p">(</span><span class="n">_getshaders</span><span class="p">(</span><span class="n">shaderpath</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;styles.css&#39;</span><span class="p">],</span> <span class="n">jslibs</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">,</span> <span class="n">lighttheme</span><span class="o">=</span><span class="n">lighttheme</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_webglboxcode</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lighttheme</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns WebGL base code for the bounding box interactor window</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">jslibs</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;gl-matrix-min.js&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;OK-min.js&#39;</span><span class="p">,</span> <span class="s1">&#39;control.js&#39;</span><span class="p">,</span> <span class="s1">&#39;drawbox.js&#39;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">_webglcode</span><span class="p">(</span><span class="n">fragmentShader</span> <span class="o">+</span> <span class="n">vertexShader</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;control.css&#39;</span><span class="p">],</span> <span class="n">jslibs</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">,</span> <span class="n">lighttheme</span><span class="o">=</span><span class="n">lighttheme</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_getcss</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;styles.css&quot;</span><span class="p">]):</span>
    <span class="c1">#Load stylesheets to inline tag</span>
    <span class="k">return</span> <span class="n">_filestohtml</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;style&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_getjslibs</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="c1">#Load a set of combined javascript libraries in script tags</span>
    <span class="k">return</span> <span class="n">_filestohtml</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_filestohtml</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;script&quot;</span><span class="p">):</span>
    <span class="c1">#Load a set of files into a string enclosed in specified html tag</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="n">_readfilehtml</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">code</span>

<span class="k">def</span> <span class="nf">_readfilehtml</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c1">#HACK: Need to disable require.js to load libraries from inline script tags</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;!REQUIRE_OFF&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;_backup_define = window.define; window.define = undefined;&#39;</span>
    <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;!REQUIRE_ON&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;window.define = _backup_define; delete _backup_define;&#39;</span>

    <span class="c1">#Read a file from the htmlpath (or cached copy)</span>
    <span class="k">global</span> <span class="n">_file_cache</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">_file_cache</span><span class="p">:</span>
        <span class="n">_file_cache</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">_readfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">htmlpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_file_cache</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_readfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c1">#Read a text file and return contents</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">_getshaders</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">shaders</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="s1">&#39;triangles&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">]):</span>
    <span class="c1">#Load combined shaders</span>
    <span class="n">src</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">sdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span> <span class="p">:</span> <span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="s1">&#39;lines&#39;</span> <span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;triangles&#39;</span> <span class="p">:</span> <span class="s1">&#39;tri&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span> <span class="p">:</span> <span class="s1">&#39;volume&#39;</span><span class="p">};</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">shaders</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">+=</span> <span class="s1">&#39;&lt;script id=&quot;&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;-vs&quot; type=&quot;x-shader/x-vertex&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">src</span> <span class="o">+=</span> <span class="n">_readfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Shader.vert&#39;</span><span class="p">))</span>
        <span class="n">src</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/script&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">src</span> <span class="o">+=</span> <span class="s1">&#39;&lt;script id=&quot;&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;-fs&quot; type=&quot;x-shader/x-fragment&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">src</span> <span class="o">+=</span> <span class="n">_readfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Shader.frag&#39;</span><span class="p">))</span>
        <span class="n">src</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/script&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">src</span>

<span class="k">class</span> <span class="nc">_Action</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for an action triggered by a control</span>

<span class="sd">    Default action is to run a command</span>

<span class="sd">    also holds the global action list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">readproperty</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">=</span> <span class="n">readproperty</span>
        <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastvalue</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Return script action for HTML export</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#Run a command with a value argument</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39; &quot; + value + &quot;&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">export_actions</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">#Process actions</span>
        <span class="n">actionjs</span> <span class="o">=</span> <span class="s1">&#39;&lt;script type=&quot;text/javascript&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">port</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">actionjs</span> <span class="o">+=</span> <span class="s1">&#39;function init(viewerid) {{_wi[viewerid] = new WindowInteractor(viewerid, </span><span class="si">{uid}</span><span class="s1">, </span><span class="si">{port}</span><span class="s1">);</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">actionjs</span> <span class="o">+=</span> <span class="s1">&#39;function init(viewerid) {_wi[viewerid] = new WindowInteractor(viewerid, </span><span class="si">{uid}</span><span class="s1">);</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="p">)</span>

        <span class="n">actionjs</span> <span class="o">+=</span> <span class="s1">&#39;_wi[viewerid].actions = [</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="c1">#Default placeholder action</span>
            <span class="n">actscript</span> <span class="o">=</span> <span class="n">act</span><span class="o">.</span><span class="n">script</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actscript</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#No action</span>
                <span class="k">pass</span>
            <span class="c1">#Add to actions list</span>
            <span class="n">actionjs</span> <span class="o">+=</span> <span class="s1">&#39;  function(value) {_wi[viewerid].execute(&quot;&#39;</span> <span class="o">+</span> <span class="n">actscript</span> <span class="o">+</span> <span class="s1">&#39;&quot;);},</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1">#Add init and finish</span>
        <span class="n">actionjs</span> <span class="o">+=</span> <span class="s1">&#39;  null ];</span><span class="se">\n</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&lt;/script&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">actionjs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;control.html&quot;</span><span class="p">,</span> <span class="n">viewerid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fullpage</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1">#Dump all output to control.html in current directory &amp; htmlpath</span>
        <span class="c1">#Process actions</span>
        <span class="n">actionjs</span> <span class="o">=</span> <span class="n">_Action</span><span class="o">.</span><span class="n">export_actions</span><span class="p">()</span>

        <span class="n">full_html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;</span><span class="se">\n</span><span class="s1">&lt;head&gt;</span><span class="se">\n</span><span class="s1">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=ISO-8859-1&quot;&gt;&#39;</span>
        <span class="n">full_html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;</span><span class="se">\n</span><span class="s1">&lt;head&gt;</span><span class="se">\n</span><span class="s1">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=ISO-8859-1&quot;&gt;&#39;</span>
        <span class="n">full_html</span> <span class="o">+=</span> <span class="n">_webglboxcode</span><span class="p">()</span>
        <span class="n">full_html</span> <span class="o">+=</span> <span class="n">actionjs</span>
        <span class="n">full_html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/head&gt;</span><span class="se">\n</span><span class="s1">&lt;body onload=&quot;init(</span><span class="si">{0}</span><span class="s1">);&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">viewerid</span><span class="p">)</span>
        <span class="n">full_html</span> <span class="o">+=</span> <span class="n">html</span>
        <span class="n">full_html</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;/body&gt;</span><span class="se">\n</span><span class="s2">&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1">#Write the file, locally and in htmlpath</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1">#This will fail if htmlpath is a non writable location</span>
            <span class="c1">#filename = os.path.join(htmlpath, filename)</span>
            <span class="n">hfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">hfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">full_html</span><span class="p">)</span>
            <span class="n">hfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">full_html</span>

<span class="k">class</span> <span class="nc">_PropertyAction</span><span class="p">(</span><span class="n">_Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Property change action triggered by a control</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">=</span> <span class="n">prop</span>
        <span class="c1">#Default action after property set is redraw, can be set to provided</span>
        <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;redraw&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_PropertyAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Return script action for HTML export</span>
        <span class="c1">#Set a property</span>
        <span class="c1">#Check for index (3D prop)</span>
        <span class="n">propset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">+</span> <span class="s1">&#39;=&quot; + value + &quot;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">propset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]=&quot; + value + &quot;&#39;</span>
        <span class="c1"># - Globally</span>
        <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">_isviewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
            <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;select; &#39;</span> <span class="o">+</span> <span class="n">propset</span>
        <span class="c1"># - on an object selector, select the object</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;ObjectSelect&#39;</span><span class="p">:</span>
            <span class="n">script</span> <span class="o">=</span> <span class="n">propset</span>
        <span class="c1"># - On an object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="n">propset</span>
        <span class="c1">#Add any additional commands</span>
        <span class="k">return</span> <span class="n">script</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span> <span class="o">+</span> <span class="nb">super</span><span class="p">(</span><span class="n">_PropertyAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">script</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_CommandAction</span><span class="p">(</span><span class="n">_Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Command action triggered by a control, with object select before command</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">readproperty</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_CommandAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">readproperty</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Return script action for HTML export</span>
        <span class="c1">#Set a property</span>
        <span class="c1"># - Globally</span>
        <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">_isviewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
            <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;select; &#39;</span>
        <span class="c1"># - on an object selector, select the object</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;ObjectSelect&#39;</span><span class="p">:</span>
            <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># - On an object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
        <span class="c1">#Add the commands</span>
        <span class="k">return</span> <span class="n">script</span> <span class="o">+</span> <span class="nb">super</span><span class="p">(</span><span class="n">_CommandAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">script</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">_FilterAction</span><span class="p">(</span><span class="n">_PropertyAction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Filter property change action triggered by a control</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">findex</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findex</span> <span class="o">=</span> <span class="n">findex</span>
        <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;redraw&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_FilterAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Return script action for HTML export</span>
        <span class="c1">#Set a filter range</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;filtermin&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">==</span> <span class="s2">&quot;minimum&quot;</span> <span class="k">else</span> <span class="s2">&quot;filtermax&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;select &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">findex</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &quot; + value + &quot;&#39;</span>
        <span class="c1">#propset = &quot;filters=&quot; + json.dumps()</span>
        <span class="c1">#script = &#39;select &#39; + self.target[&quot;name&quot;] + &#39;; &#39; + propset</span>

<div class="viewcode-block" id="HTML"><a class="viewcode-back" href="../control.html#control.HTML">[docs]</a><span class="k">class</span> <span class="nc">HTML</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class to output HTML controls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lastid</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#Parent class for container types</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniqueid</span><span class="p">()</span>

<div class="viewcode-block" id="HTML.html"><a class="viewcode-back" href="../control.html#control.HTML.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the HTML code&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>

    <span class="k">def</span> <span class="nf">uniqueid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Get a unique control identifier</span>
        <span class="n">HTML</span><span class="o">.</span><span class="n">lastid</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elid</span> <span class="o">=</span> <span class="s2">&quot;lvctrl_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">HTML</span><span class="o">.</span><span class="n">lastid</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span></div>

<div class="viewcode-block" id="Container"><a class="viewcode-back" href="../control.html#control.Container">[docs]</a><span class="k">class</span> <span class="nc">Container</span><span class="p">(</span><span class="n">HTML</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A container for a set of controls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Parent class for container types</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span> <span class="c1">#WEAKREF?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Container</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>

<div class="viewcode-block" id="Container.html"><a class="viewcode-back" href="../control.html#control.Container.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">)):</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">html</span></div></div>

<div class="viewcode-block" id="Window"><a class="viewcode-back" href="../control.html#control.Window">[docs]</a><span class="k">class</span> <span class="nc">Window</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an interaction window with an image of the viewer frame </span>
<span class="sd">    and webgl controller for rotation/translation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    align : str</span>
<span class="sd">        Set to &quot;left/right&quot; to align viewer window, default is left</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Window</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">viewer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="n">align</span>

<div class="viewcode-block" id="Window.html"><a class="viewcode-back" href="../control.html#control.Window.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrapperstyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;min-height: 200px; min-width: 200px; position: relative; display: inline-block; &#39;</span>
        <span class="n">style</span> <span class="o">+=</span> <span class="s1">&#39;float: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span>
        <span class="k">if</span> <span class="n">wrapper</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">+=</span> <span class="s1">&#39; margin-right: 10px;&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div style=&quot;&#39;</span> <span class="o">+</span> <span class="n">style</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;img id=&quot;imgtarget_---VIEWERID---&quot; draggable=false style=&quot;margin: 0px; border: 1px solid #aaa; display: inline-block;&quot; src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAAPUlEQVR42u3OMQEAAAgDINe/iSU1xh5IQPamKgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLtwAMBsGqBDct9xQAAAABJRU5ErkJggg==&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           &lt;div style=&quot;display: none; z-index: 200; position: absolute; top: 5px; right: 5px;&quot;&gt;</span>
<span class="s2">             &lt;select onchange=&quot;_wi[---VIEWERID---].box.mode = this.value;&quot;&gt;</span>
<span class="s2">               &lt;option&gt;Rotate&lt;/option&gt;</span>
<span class="s2">               &lt;option&gt;Translate&lt;/option&gt;</span>
<span class="s2">               &lt;option&gt;Zoom&lt;/option&gt;</span>
<span class="s2">             &lt;/select&gt;</span>
<span class="s2">             &lt;input type=&quot;button&quot; value=&quot;Reset&quot; onclick=&quot;_wi[---VIEWERID---].execute(&#39;reset&#39;);&quot;&gt;</span>
<span class="s2">           &lt;/div&gt;&quot;&quot;&quot;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1">#Display any contained controls</span>
        <span class="k">if</span> <span class="n">wrapper</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div style=&quot;&#39;</span> <span class="o">+</span> <span class="n">wrapperstyle</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;lvctrl&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Window</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">wrapper</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1">#html += &#39;&lt;div style=&quot;clear: both;&quot;&gt;\n&#39;</span>
        <span class="k">return</span> <span class="n">html</span></div></div>

<div class="viewcode-block" id="Panel"><a class="viewcode-back" href="../control.html#control.Panel">[docs]</a><span class="k">class</span> <span class="nc">Panel</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a control panel with an interactive viewer window and a set of controls</span>
<span class="sd">    By default the controls will be placed to the left with the viewer aligned to the right</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    showwin : boolean</span>
<span class="sd">        Set to False to exclude the interactive window</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">showwin</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Panel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">viewer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">showwin</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Panel.html"><a class="viewcode-back" href="../control.html#control.Panel.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">:</span> <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="n">wrapper</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#Add control wrapper</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div style=&quot;padding:0px; margin: 0px; position: relative;&quot; class=&quot;lvctrl&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Panel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1">#if self.win: html += self.win.html(wrapperstyle=&quot;float: left; padding:0px; margin: 0px; position: relative;&quot;)</span>
        <span class="k">return</span> <span class="n">html</span></div></div>

<div class="viewcode-block" id="Tabs"><a class="viewcode-back" href="../control.html#control.Tabs">[docs]</a><span class="k">class</span> <span class="nc">Tabs</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a group of controls with tabs that can be shown or hidden</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    buttons : boolean</span>
<span class="sd">        Display the tab buttons for switching tabs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">buttons</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Tabs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

<div class="viewcode-block" id="Tabs.tab"><a class="viewcode-back" href="../control.html#control.Tabs.tab">[docs]</a>    <span class="k">def</span> <span class="nf">tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new tab, any controls appending will appear in the new tab</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str</span>
<span class="sd">            Label for the tab, if omitted will be blank</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
        <span class="n">ctrl</span><span class="o">.</span><span class="n">tab</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

<div class="viewcode-block" id="Tabs.html"><a class="viewcode-back" href="../control.html#control.Tabs.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;script&gt;</span>
<span class="s2">        function openTab_---ELID---(el, tabName) {</span>
<span class="s2">          var i;</span>
<span class="s2">          var x = document.getElementsByClassName(&quot;---ELID---&quot;);</span>
<span class="s2">          for (i = 0; i &lt; x.length; i++)</span>
<span class="s2">             x[i].style.display = &quot;none&quot;;  </span>
<span class="s2">          document.getElementById(&quot;---ELID---_&quot; + tabName).style.display = &quot;block&quot;;  </span>

<span class="s2">          tabs = document.getElementsByClassName(&quot;tab_---ELID---&quot;);</span>
<span class="s2">          for (i = 0; i &lt; x.length; i++)</span>
<span class="s2">            tabs[i].className = tabs[i].className.replace(&quot; lvseltab&quot;, &quot;&quot;);</span>
<span class="s2">          el.className += &quot; lvseltab&quot;;</span>
<span class="s2">        }</span>
<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;div class=&#39;lvtabbar&#39;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">)):</span>
                <span class="c1">#Add header items</span>
                <span class="n">classes</span> <span class="o">=</span> <span class="s1">&#39;lvbutton lvctrl tab_---ELID---&#39;</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">classes</span> <span class="o">+=</span> <span class="s1">&#39; lvseltab&#39;</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;button class=&quot;&#39;</span> <span class="o">+</span> <span class="n">classes</span> <span class="o">+</span> <span class="s1">&#39;&quot; onclick=&quot;openTab_---ELID---(this, this.innerHTML)&quot;&gt;---LABEL---&lt;/button&gt;&#39;</span>
                <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---LABEL---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">)):</span>
            <span class="c1">#Add control wrappers</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;display: none;&#39;</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div id=&quot;---ELID---_---LABEL---&quot; style=&quot;&#39;</span> <span class="o">+</span> <span class="n">style</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;lvtab lvctrl ---ELID---&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">ctrl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">tab</span> <span class="o">==</span> <span class="n">t</span><span class="p">:</span>
                    <span class="n">html</span> <span class="o">+=</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---LABEL---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span></div></div>

<div class="viewcode-block" id="Control"><a class="viewcode-back" href="../control.html#control.Control">[docs]</a><span class="k">class</span> <span class="nc">Control</span><span class="p">(</span><span class="n">HTML</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control object</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : Obj or Viewer</span>
<span class="sd">        Add a control to an object to control object properties</span>
<span class="sd">        Add a control to a viewer to control global proerties and run commands</span>
<span class="sd">    property : str</span>
<span class="sd">        Property to modify</span>
<span class="sd">    command : str</span>
<span class="sd">        Command to run</span>
<span class="sd">    value : any type</span>
<span class="sd">        Initial value of the controls</span>
<span class="sd">    label : str</span>
<span class="sd">        Descriptive label for the control</span>
<span class="sd">    readproperty : str</span>
<span class="sd">        Property to read control value from on update (but not modified)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">readproperty</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Control</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

        <span class="c1">#Get id and add to register</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>

        <span class="c1">#Can either set a property directly or run a command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">=</span> <span class="n">readproperty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="nb">property</span><span class="p">:</span>
            <span class="c1">#Property set</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">_PropertyAction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="nb">property</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">=</span> <span class="nb">property</span>
        <span class="k">elif</span> <span class="n">command</span><span class="p">:</span>
            <span class="c1">#Command only</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">_CommandAction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">readproperty</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Assume derived class will fill out the action, this is just a placeholder</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">_Action</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1">#Get value from target or default if not provided</span>
        <span class="k">if</span> <span class="nb">property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">_getproperty</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#2d/3D value?</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
                    <span class="n">V</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">target</span><span class="p">[</span><span class="nb">property</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span> <span class="c1">#Set the provided value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">target</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="c1">#Set the provided value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1">#Append reload command from prop dict if no command provided</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">and</span> <span class="nb">property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_lv</span> <span class="o">=</span> <span class="n">_getviewer</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span>  <span class="nb">property</span> <span class="ow">in</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
                <span class="c1">#TODO: support higher reload values</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;redraw&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;reload&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;reload&quot;</span>
                <span class="k">elif</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;redraw&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;redraw&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;reload&quot;</span>
                <span class="c1">#Append if command exists</span>
                <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">cmd</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="n">command</span> <span class="o">+=</span> <span class="s2">&quot; ; &quot;</span> <span class="o">+</span> <span class="n">cmd</span>

    <span class="k">def</span> <span class="nf">onchange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;_wi[---VIEWERID---].do_action(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, this.value, this);&quot;</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Show only this control</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div style=&quot;&quot; class=&quot;lvctrl&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="Control.html"><a class="viewcode-back" href="../control.html#control.Control.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">labelhtml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Default label</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">):</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p&gt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;:&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">html</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="n">attribs</span><span class="o">=</span><span class="p">{},</span> <span class="n">onchange</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="c1">#Input control</span>
        <span class="n">html</span> <span class="o">=</span>  <span class="s1">&#39;&lt;input id=&quot;---ELID---&quot; class=&quot;---ELID---&quot; type=&quot;&#39;</span> <span class="o">+</span> <span class="nb">type</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
        <span class="c1">#Set custom attribute for property controls</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;step&quot;</span> <span class="ow">in</span> <span class="n">attribs</span> <span class="ow">or</span> <span class="n">attribs</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attribs</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span>
            <span class="c1">#if self.value:</span>
            <span class="c1">#    attribs[&quot;step&quot;] = abs(self.value) / 100.</span>
            <span class="c1">#else:</span>
            <span class="c1">#    attribs[&quot;step&quot;] = &quot;any&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;value=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
        <span class="c1">#Onchange event</span>
        <span class="n">onchange</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onchange</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;onchange=&quot;&#39;</span> <span class="o">+</span> <span class="n">onchange</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span>

    <span class="k">def</span> <span class="nf">attribs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="p">:</span>
            <span class="c1">#Set custom attribute for property controls</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_isviewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;data-target=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;data-property=&quot;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
            <span class="k">if</span> <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;data-index=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
        <span class="k">return</span> <span class="n">html</span></div>

<div class="viewcode-block" id="Divider"><a class="viewcode-back" href="../control.html#control.Divider">[docs]</a><span class="k">class</span> <span class="nc">Divider</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A divider element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;hr style=&quot;clear: both;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="Number"><a class="viewcode-back" href="../control.html#control.Number">[docs]</a><span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A basic numerical input control</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">readproperty</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">readproperty</span><span class="p">)</span>

        <span class="c1">#Get step defaults from prop dict</span>
        <span class="n">_lv</span> <span class="o">=</span> <span class="n">_getviewer</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
            <span class="c1">#Check for integer type, set default step to 1</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;integer&quot;</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">attribs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;step&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">}</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">controls</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="n">attribs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="Number2D"><a class="viewcode-back" href="../control.html#control.Number2D">[docs]</a><span class="k">class</span> <span class="nc">Number2D</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of two numeric controls for adjusting a 2D value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Number2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">_getproperty</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span></div>

<div class="viewcode-block" id="Number3D"><a class="viewcode-back" href="../control.html#control.Number3D">[docs]</a><span class="k">class</span> <span class="nc">Number3D</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of three numeric controls for adjusting a 3D value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Number3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">_getproperty</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ</span> <span class="o">=</span> <span class="n">Number</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span></div>

<div class="viewcode-block" id="Rotation"><a class="viewcode-back" href="../control.html#control.Rotation">[docs]</a><span class="k">class</span> <span class="nc">Rotation</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of six buttons for adjusting a 3D rotation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rotation&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Rotation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX0</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;rotate x -1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;-X&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX1</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;rotate x 1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;+X&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY0</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;rotate y -1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;-Y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY1</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;rotate y 1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;+Y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ0</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;rotate z -1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;-Z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ1</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;rotate z 1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;+Z&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX0</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX1</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY0</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY1</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ0</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ1</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span></div>


<div class="viewcode-block" id="Checkbox"><a class="viewcode-back" href="../control.html#control.Checkbox">[docs]</a><span class="k">class</span> <span class="nc">Checkbox</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A checkbox control for a boolean value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">labelhtml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="c1">#&#39;&lt;br&gt;\n&#39;</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attribs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">attribs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;checked&quot;</span> <span class="p">:</span> <span class="s2">&quot;checked&quot;</span><span class="p">}</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;label&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Checkbox</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">controls</span><span class="p">(</span><span class="s1">&#39;checkbox&#39;</span><span class="p">,</span> <span class="n">attribs</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s2">&quot;&lt;/label&gt;&lt;br&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">html</span>

    <span class="k">def</span> <span class="nf">onchange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;; _wi[---VIEWERID---].do_action(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, this.checked ? 1 : 0, this);&quot;</span></div>

<div class="viewcode-block" id="Range"><a class="viewcode-back" href="../control.html#control.Range">[docs]</a><span class="k">class</span> <span class="nc">Range</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A slider control for a range of values</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range : list or tuple</span>
<span class="sd">        Min/max values for the range</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">readproperty</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Range</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">readproperty</span><span class="p">)</span>

        <span class="c1">#Get range &amp; step defaults from prop dict</span>
        <span class="n">_lv</span> <span class="o">=</span> <span class="n">_getviewer</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">defrange</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
            <span class="c1">#Check for integer type, set default step to 1</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;integer&quot;</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
                <span class="n">defrange</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">defrange</span> <span class="o">=</span> <span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">range</span> <span class="o">=</span> <span class="n">defrange</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">defrange</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="nb">range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span><span class="p">:</span>
            <span class="c1">#Assume a step size of 1 if range max-min &gt; 5 and both are integers</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="mf">100.0</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attribs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;max&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;step&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">}</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Range</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">controls</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="n">attribs</span><span class="p">,</span> <span class="n">onchange</span><span class="o">=</span><span class="s1">&#39;this.nextElementSibling.value=this.value; &#39;</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Range</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">controls</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="n">attribs</span><span class="p">,</span> <span class="n">onchange</span><span class="o">=</span><span class="s1">&#39;this.previousElementSibling.value=this.value; &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="Button"><a class="viewcode-back" href="../control.html#control.Button">[docs]</a><span class="k">class</span> <span class="nc">Button</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A push button control to execute a defined command</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Button</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onchange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;_wi[---VIEWERID---].do_action(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &#39;&#39;, this);&quot;</span>

    <span class="k">def</span> <span class="nf">labelhtml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">=</span>  <span class="s1">&#39;&lt;input class=&quot;---ELID---&quot; type=&quot;button&quot; value=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
        <span class="c1">#Onclick event</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;onclick=&quot;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">onchange</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&gt;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span></div>

<div class="viewcode-block" id="Entry"><a class="viewcode-back" href="../control.html#control.Entry">[docs]</a><span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A generic input control for string values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;input class=&quot;---ELID---&quot; type=&quot;text&quot; value=&quot;&quot; &#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39; onkeypress=&quot;if (event.keyCode == 13) { _wi[---VIEWERID---].do_action(---ID---, this.value.trim(), this); };&quot;&gt;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Command"><a class="viewcode-back" href="../control.html#control.Command">[docs]</a><span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A generic input control for executing command strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Command</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Command&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;input class=&quot;---ELID---&quot; type=&quot;text&quot; value=&quot;&quot; </span>
<span class="s2">        onkeypress=&quot;if (event.keyCode == 13) { var cmd=this.value.trim(); </span>
<span class="s2">        _wi[---VIEWERID---].do_action(---ID---, cmd ? cmd : &#39;repeat&#39;, this); this.value=&#39;&#39;; };&quot;&gt;&lt;br&gt;</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="File"><a class="viewcode-back" href="../control.html#control.File">[docs]</a><span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A file picker control</span>

<span class="sd">    Unfortunately there is no way to get the file path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">accept</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">+=</span> <span class="s1">&#39;webkitdirectory directory &#39;</span>
        <span class="k">elif</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">+=</span> <span class="s1">&#39;multiple &#39;</span>
        <span class="k">if</span> <span class="n">accept</span><span class="p">:</span>
            <span class="c1">#Comma separated file types list, eg: image/*,audio/*,video/*,.pdf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">+=</span> <span class="s1">&#39;accept=&quot;&#39;</span> <span class="o">+</span> <span class="n">accept</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">File</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Load File&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;div style=&quot;border:solid #aaa 1px; padding:10px; margin-bottom: 5px;&quot;&gt;</span>
<span class="s2">        &lt;input class=&quot;---ELID---&quot; type=&quot;file&quot; id=&quot;file_selector_---ELID---&quot; ---OPTIONS--- name=&quot;files[]&quot;/&gt;</span>
<span class="s2">        &lt;output id=&quot;list&quot;&gt;&lt;/output&gt;</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">        &lt;script&gt;</span>
<span class="s2">          function fileSelected_---ELID---(event) {</span>
<span class="s2">            var output = [];</span>
<span class="s2">            for (var i = 0; i &lt; event.target.files.length; i++) {</span>
<span class="s2">              var f = event.target.files.item(i);</span>
<span class="s2">              output.push(&#39;&lt;li&gt;&lt;strong&gt;&#39;, escape(f.name), &#39;&lt;/strong&gt; (&#39;, f.type || &#39;n/a&#39;, &#39;) - &#39;,</span>
<span class="s2">                           f.size, &#39; bytes, last modified: &#39;,</span>
<span class="s2">                           &#39;&lt;/li&gt;&#39;);</span>
<span class="s2">                _wi[---VIEWERID---].do_action(&quot;---ID---&quot;, f.name);</span>
<span class="s2">            }</span>
<span class="s2">            document.getElementById(&#39;list&#39;).innerHTML = &#39;&lt;ul&gt;&#39; + output.join(&#39;&#39;) + &#39;&lt;/ul&gt;&#39;;</span>
<span class="s2">          }</span>
<span class="s2">          document.getElementById(&#39;file_selector_---ELID---&#39;).addEventListener(&#39;change&#39;, fileSelected_---ELID---, false);            </span>
<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---OPTIONS---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="List"><a class="viewcode-back" href="../control.html#control.List">[docs]</a><span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A list of predefined input values to set properties or run commands</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    options: list</span>
<span class="sd">        List of the available value strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Get default options from prop dict</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defoptions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">_lv</span> <span class="o">=</span> <span class="n">_getviewer</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span>  <span class="nb">property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
                <span class="n">ctrl</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">defoptions</span> <span class="o">=</span> <span class="n">ctrl</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">defoptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;select class=&quot;---ELID---&quot; id=&quot;---ELID---&quot; value=&quot;&quot; &#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;onchange=&quot;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">onchange</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="c1">#Each element of options list can be:</span>
            <span class="c1"># - dict {&quot;label&quot; : label, &quot;value&quot; : value, &quot;selected&quot; : True/False}</span>
            <span class="c1"># - list [value, label, selected]</span>
            <span class="c1"># - value only</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span> <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">selected</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="n">selected</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">opt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;option value=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="n">selected</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;option&gt;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/option&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/select&gt;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span></div>

<div class="viewcode-block" id="Colour"><a class="viewcode-back" href="../control.html#control.Colour">[docs]</a><span class="k">class</span> <span class="nc">Colour</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A colour picker for setting colour properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Colour</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;div&gt;&lt;div class=&quot;colourbg checkerboard&quot;&gt;</span>
<span class="s2">          &lt;div id=&quot;---ELID---&quot; ---ATTRIBS--- class=&quot;colour ---ELID---&quot; onclick=&quot;</span>
<span class="s2">            var col = new Colour(this.style.backgroundColor);</span>
<span class="s2">            var offset = [this.getBoundingClientRect().left, this.getBoundingClientRect().top];</span>
<span class="s2">            var el = this;</span>
<span class="s2">            var savefn = function(val) {</span>
<span class="s2">              var c = new Colour(0);</span>
<span class="s2">              c.setHSV(val);</span>
<span class="s2">              el.style.backgroundColor = c.html();</span>
<span class="s2">              _wi[---VIEWERID---].do_action(---ID---, c.html(), el);</span>
<span class="s2">            }</span>
<span class="s2">            el.picker = new ColourPicker(savefn);</span>
<span class="s2">            el.picker.pick(col, offset[0], offset[1]);&quot;&gt;</span>
<span class="s2">          &lt;/div&gt;</span>
<span class="s2">        &lt;/div&gt;&lt;/div&gt;</span>
<span class="s2">        &lt;script&gt;</span>
<span class="s2">        var el = document.getElementById(&quot;---ELID---&quot;);</span>
<span class="s2">        //Set the initial colour</span>
<span class="s2">        var col = new Colour(&#39;---VALUE---&#39;);</span>
<span class="s2">        el.style.backgroundColor = col.html();</span>
<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---VALUE---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ATTRIBS---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Gradient"><a class="viewcode-back" href="../control.html#control.Gradient">[docs]</a><span class="k">class</span> <span class="nc">Gradient</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A colourmap editor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Gradient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s2">&quot;colourmap&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#Get and save the map id of target object</span>
        <span class="k">if</span> <span class="n">_isviewer</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Gradient control requires an Object target, not Viewer&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;colourmaps&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;canvas id=&quot;---ELID---&quot; ---ATTRIBS--- width=&quot;512&quot; height=&quot;24&quot; class=&quot;palette checkerboard&quot;&gt;</span>
<span class="s2">        &lt;/canvas&gt;</span>
<span class="s2">        &lt;script&gt;</span>
<span class="s2">        var el = document.getElementById(&quot;---ELID---&quot;); //Get the canvas</span>
<span class="s2">        //Store the maps</span>
<span class="s2">        el.colourmaps = ---COLOURMAPS---;</span>
<span class="s2">        el.currentmap = ---COLOURMAP---;</span>
<span class="s2">        el.selectedIndex = ---SELID---;</span>
<span class="s2">        if (!el.gradient) {</span>
<span class="s2">          //Create the gradient editor</span>
<span class="s2">          el.gradient = new GradientEditor(el, function(obj, id) {</span>
<span class="s2">            //Gradient updated</span>
<span class="s2">            //var colours = obj.palette.toJSON()</span>
<span class="s2">            el.currentmap = obj.palette.get(el.currentmap);</span>
<span class="s2">            _wi[---VIEWERID---].do_action(---ID---, JSON.stringify(el.currentmap.colours));</span>
<span class="s2">            //_wi[---VIEWERID---].do_action(---ID---, obj.palette.toJSON(), el);</span>

<span class="s2">            //Update stored maps list by name</span>
<span class="s2">            if (el.selectedIndex &gt;= 0)</span>
<span class="s2">              el.colourmaps[el.selectedIndex].colours = el.currentmap.colours; //el.gradient.palette.get();</span>
<span class="s2">          }</span>
<span class="s2">          , true); //Enable premultiply</span>
<span class="s2">        }</span>
<span class="s2">        //Load the initial colourmap</span>
<span class="s2">        el.gradient.read(el.currentmap.colours);</span>
<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---COLOURMAPS---&#39;</span><span class="p">,</span> <span class="n">mapstr</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---COLOURMAP---&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---COLOURMAP---&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;black white&quot;&#39;</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---SELID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected</span><span class="p">))</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ATTRIBS---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span></div>

<div class="viewcode-block" id="ColourMapList"><a class="viewcode-back" href="../control.html#control.ColourMapList">[docs]</a><span class="k">class</span> <span class="nc">ColourMapList</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A colourmap list selector, populated by the default colour maps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_isviewer</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ColourMapList control requires an Object target, not Viewer&quot;</span><span class="p">))</span>
        <span class="c1">#Load maps list</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">defaultcolourmaps</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">selection</span>
        <span class="c1">#Also add the matplotlib colourmaps if available</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Load maps list</span>
            <span class="kn">import</span> <span class="nn">matplotlib</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">colormaps</span><span class="p">()</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">colormaps</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1">#Preceding command with &#39;.&#39; calls via python API, allowing use of matplotlib maps</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ColourMapList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;.colourmap&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Load Colourmap&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ColourMaps"><a class="viewcode-back" href="../control.html#control.ColourMaps">[docs]</a><span class="k">class</span> <span class="nc">ColourMaps</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A colourmap list selector, populated by the available colour maps,</span>
<span class="sd">    combined with a colourmap editor for the selected colour map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Load maps list</span>
        <span class="k">if</span> <span class="n">_isviewer</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ColourMaps control requires an Object target, not Viewer&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;colourmaps&quot;</span><span class="p">]</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">]]</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="s2">&quot;colourmap&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">sel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">)):</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]])</span>
            <span class="c1">#Mark selected</span>
            <span class="k">if</span> <span class="n">sel</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
                <span class="n">options</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="n">m</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">Gradient</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="n">sel</span> <span class="c1">#gradient editor needs to know selection index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1">#Clear label</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ColourMaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s2">&quot;colourmap&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onchange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Find the saved palette entry and load it</span>
        <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        var el = document.getElementById(&#39;---PALLID---&#39;); </span>
<span class="s2">        var sel = document.getElementById(&#39;---ELID---&#39;);</span>
<span class="s2">        if (sel.selectedIndex &gt; 0) {</span>
<span class="s2">          el.selectedIndex = sel.selectedIndex-1;</span>
<span class="s2">          el.currentmap = el.colourmaps[el.selectedIndex];</span>
<span class="s2">          el.gradient.read(el.currentmap.colours);</span>
<span class="s2">        }</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">script</span> <span class="o">+</span> <span class="nb">super</span><span class="p">(</span><span class="n">ColourMaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">onchange</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ColourMaps</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---PALLID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">elid</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">html</span></div>

<div class="viewcode-block" id="TimeStepper"><a class="viewcode-back" href="../control.html#control.TimeStepper">[docs]</a><span class="k">class</span> <span class="nc">TimeStepper</span><span class="p">(</span><span class="n">Range</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A time step selection range control with up/down buttons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#Acts as a command setter with some additional controls</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimeStepper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">viewer</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Timestep&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="n">readproperty</span><span class="o">=</span><span class="s2">&quot;timestep&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">timesteps</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">#Calculate step gap</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">Range</span><span class="o">.</span><span class="n">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#Note: unicode symbol escape must use double slash to be</span>
        <span class="c1"># passed through to javascript or python will process them</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;script&gt;</span>
<span class="s2">        var timer_---ELID--- = -1;</span>
<span class="s2">        function startTimer_---ELID---() {</span>
<span class="s2">          if (timer_---ELID--- &gt;= 0) {</span>
<span class="s2">            if (timer_---ELID--- &gt; 0)</span>
<span class="s2">              window.cancelAnimationFrame(timer_---ELID---);</span>
<span class="s2">            timer_---ELID--- = window.requestAnimationFrame(nextStep_---ELID---);</span>
<span class="s2">          }</span>
<span class="s2">        }</span>
<span class="s2">        function nextStep_---ELID---() {</span>
<span class="s2">          el = document.getElementById(&#39;---ELID---&#39;);</span>
<span class="s2">          if (el) {</span>
<span class="s2">            //Call again on image load - pass callback</span>
<span class="s2">            var V = _wi[---VIEWERID---];</span>
<span class="s2">            if (!V.box.canvas.mouse.isdown &amp;&amp; !V.box.zoomTimer &amp;&amp; (!V.box.gui || V.box.gui.closed))</span>
<span class="s2">              V.execute(&quot;next&quot;, startTimer_---ELID---);</span>
<span class="s2">            else</span>
<span class="s2">              setTimeout(nextStep_---ELID---, 100);</span>
<span class="s2">          }</span>
<span class="s2">        }</span>
<span class="s2">        function playPause_---ELID---(btn) {</span>
<span class="s2">          if (timer_---ELID--- &gt;= 0) {</span>
<span class="s2">            btn.value=&quot;</span><span class="se">\\</span><span class="s2">u25BA&quot;;</span>
<span class="s2">            btn.style.fontSize = &quot;12px&quot;</span>
<span class="s2">            window.cancelAnimationFrame(timer_---ELID---);</span>
<span class="s2">            timer_---ELID--- = -1;</span>
<span class="s2">          } else {</span>
<span class="s2">            timer_---ELID--- = 0;</span>
<span class="s2">            startTimer_---ELID---();</span>
<span class="s2">            btn.value=&quot;</span><span class="se">\\</span><span class="s2">u25ae</span><span class="se">\\</span><span class="s2">u25ae&quot;;</span>
<span class="s2">            btn.style.fontSize = &quot;10px&quot;</span>
<span class="s2">          }</span>
<span class="s2">        }</span>
<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;input type=&quot;button&quot; style=&quot;width: 50px;&quot; onclick=&quot;var el = document.getElementById(</span><span class="se">\&#39;</span><span class="s1">---ELID---</span><span class="se">\&#39;</span><span class="s1">); el.stepDown(); el.onchange()&quot; value=&quot;&amp;larr;&quot; /&gt;&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;input type=&quot;button&quot; style=&quot;width: 50px;&quot; onclick=&quot;var el = document.getElementById(</span><span class="se">\&#39;</span><span class="s1">---ELID---</span><span class="se">\&#39;</span><span class="s1">); el.stepUp(); el.onchange()&quot; value=&quot;&amp;rarr;&quot; /&gt;&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;input type=&quot;button&quot; style=&quot;width: 60px;&quot; onclick=&quot;playPause_---ELID---(this);&quot; value=&quot;&amp;#9658;&quot; /&gt;&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---ELID---&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span></div>

<div class="viewcode-block" id="DualRange"><a class="viewcode-back" href="../control.html#control.DualRange">[docs]</a><span class="k">class</span> <span class="nc">DualRange</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of two range slider controls for adjusting a minimum and maximum range</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range : list or tuple</span>
<span class="sd">        Min/max values for the range</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmin</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="n">properties</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmax</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="n">properties</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmin</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmax</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span></div>

<div class="viewcode-block" id="Range2D"><a class="viewcode-back" href="../control.html#control.Range2D">[docs]</a><span class="k">class</span> <span class="nc">Range2D</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of two range slider controls for adjusting a 2D value</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range : list or tuple</span>
<span class="sd">        Min/max values for the ranges</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Range2D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">_getproperty</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span></div>

<div class="viewcode-block" id="Range3D"><a class="viewcode-back" href="../control.html#control.Range3D">[docs]</a><span class="k">class</span> <span class="nc">Range3D</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of three range slider controls for adjusting a 3D value</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range : list or tuple</span>
<span class="sd">        Min/max values for the ranges</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Range3D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">_getproperty</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="nb">property</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlX</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlY</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlZ</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span></div>

<div class="viewcode-block" id="Filter"><a class="viewcode-back" href="../control.html#control.Filter">[docs]</a><span class="k">class</span> <span class="nc">Filter</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of two range slider controls for adjusting a minimum and maximum filter range</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range : list or tuple</span>
<span class="sd">        Min/max values for the filter range</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">filteridx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">filteridx</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filter index out of range: &quot;</span><span class="p">,</span> <span class="n">filteridx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">][</span><span class="n">filteridx</span><span class="p">]</span>

        <span class="c1">#Default label - data set name</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="s1">&#39;by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

        <span class="c1">#Get the default range limits from the matching data source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="s1">&#39;by&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">range</span><span class="p">:</span>
            <span class="c1">#self.range = (self.filter[&quot;minimum&quot;], self.filter[&quot;maximum&quot;])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="s2">&quot;map&quot;</span><span class="p">]:</span>
                <span class="nb">range</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">range</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;minimum&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;maximum&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmin</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="s2">&quot;minimum&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmax</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">[</span><span class="s2">&quot;maximum&quot;</span><span class="p">])</span>

        <span class="c1">#Replace actions on the controls</span>
        <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrlmin</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_FilterAction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">filteridx</span><span class="p">,</span> <span class="s2">&quot;minimum&quot;</span><span class="p">)</span>
        <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrlmax</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_FilterAction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">filteridx</span><span class="p">,</span> <span class="s2">&quot;maximum&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmin</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlmax</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span></div>

<div class="viewcode-block" id="ObjectList"><a class="viewcode-back" href="../control.html#control.ObjectList">[docs]</a><span class="k">class</span> <span class="nc">ObjectList</span><span class="p">(</span><span class="n">Control</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A set of checkbox controls for controlling visibility of all visualisation objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ObjectList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">viewer</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Objects&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objctrls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">viewer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objctrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]))</span> 

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelhtml</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ctrl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objctrls</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">html</span></div>

<div class="viewcode-block" id="ObjectSelect"><a class="viewcode-back" href="../control.html#control.ObjectSelect">[docs]</a><span class="k">class</span> <span class="nc">ObjectSelect</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A list selector of all visualisation objects that can be used to</span>
<span class="sd">    choose the target of a set of controls</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objects : list</span>
<span class="sd">        A list of objects to display, by default all available objects are added</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_isviewer</span><span class="p">(</span><span class="n">viewer</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t add ObjectSelect control to an Object, must add to Viewer&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">viewer</span>
        <span class="k">if</span> <span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">list</span>
        
        <span class="c1">#Load maps list</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">objects</span><span class="p">)):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
            <span class="n">options</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">o</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span>

        <span class="c1">#The list control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">viewer</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1">#Init container</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ObjectSelect</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">viewer</span><span class="p">)</span> <span class="c1">#, label=&quot;Objects&quot;, options=options, command=&quot;select&quot;, *args, **kwargs)</span>

        <span class="c1">#Holds a control factory so controls can be added with this as a target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">_ControlFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1">#def onchange(self):</span>
    <span class="c1">#    #Update the control values on change</span>
    <span class="c1">#    #return super(ObjectSelect, self).onchange()</span>
    <span class="c1">#    return self._list.onchange()</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1">#print &quot;CONTAINS&quot;,key</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_list</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">lastvalue</span>
        <span class="c1">#print &quot;OBJECT == &quot;,obj,(key in self.parent.objects.list[obj-1])</span>
        <span class="k">return</span> <span class="n">obj</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">obj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1">#print &quot;GETITEM&quot;,key</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_list</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">lastvalue</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Passthrough: Get from selected object</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">obj</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_list</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">lastvalue</span>
        <span class="c1">#print &quot;SETITEM&quot;,key,value</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#Passtrough: Set on selected object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">obj</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1">#Undefined method call - pass call to target</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1">#__getattr__ called if no attrib/method found</span>
        <span class="k">def</span> <span class="nf">any_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1">#If member function exists on target, call it</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">_Action</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_list</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">lastvalue</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">obj</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">method</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">any_method</span>

<div class="viewcode-block" id="ObjectSelect.html"><a class="viewcode-back" href="../control.html#control.ObjectSelect.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div style=&quot;border: #888 1px solid; display: inline-block; padding: 6px;&quot; class=&quot;lvctrl&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list</span><span class="o">.</span><span class="n">controls</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;hr&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ObjectSelect</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">html</span></div>

    <span class="k">def</span> <span class="nf">controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="p">()</span></div>

<span class="k">class</span> <span class="nc">_ControlFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and manage sets of controls for interaction with a Viewer or Object</span>
<span class="sd">    Controls can run commands or change properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Creates a control factory used to generate controls for a specified target</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactor</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1">#Save types of all control/containers</span>
        <span class="k">def</span> <span class="nf">all_subclasses</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">all_subclasses</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

        <span class="c1">#Control contructor shortcut methods</span>
        <span class="c1">#(allows constructing controls directly from the factory object)</span>
        <span class="c1">#Use a closure to define a new method to call constructor and add to controls</span>
        <span class="k">def</span> <span class="nf">addmethod</span><span class="p">(</span><span class="n">constr</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="c1">#Return the new control and add it to the list</span>
                <span class="n">newctrl</span> <span class="o">=</span> <span class="n">constr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">newctrl</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">newctrl</span>
            <span class="k">return</span> <span class="n">method</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_control_types</span> <span class="o">=</span> <span class="n">all_subclasses</span><span class="p">(</span><span class="n">Control</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_container_types</span> <span class="o">=</span> <span class="n">all_subclasses</span><span class="p">(</span><span class="n">Container</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">constr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_types</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container_types</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">constr</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">addmethod</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
            <span class="c1">#Set docstring (+ Control docs)</span>
            <span class="k">if</span> <span class="n">constr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_types</span><span class="p">:</span>
                <span class="n">method</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">constr</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+</span> <span class="n">Control</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">constr</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calling with a property name creates the default control for that property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_lv</span> <span class="o">=</span> <span class="n">_getviewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">())</span>
        <span class="k">if</span>  <span class="nb">property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="c1">#Get control info from prop dict</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">_lv</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;control&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1">#Has selections</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;integer&quot;</span> <span class="ow">in</span> <span class="n">T</span> <span class="ow">or</span> <span class="s2">&quot;real&quot;</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1">#Has range</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#Has range</span>
                    <span class="k">if</span> <span class="s2">&quot;[2]&quot;</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
                       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Number2D</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;[3]&quot;</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
                       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Number3D</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">T</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">T</span> <span class="o">==</span> <span class="s2">&quot;boolean&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">T</span> <span class="o">==</span> <span class="s2">&quot;colour&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unable to determine control type for property: &quot;</span> <span class="o">+</span> <span class="nb">property</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container_types</span><span class="p">:</span>
            <span class="c1">#Save new container, further controls will be added to it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">):</span>
            <span class="c1">#Add to existing container</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Add to global list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>

        <span class="c1">#Add to viewer instance list too if not already being added</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_isviewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays all added controls including viewer if any</span>

<span class="sd">        fallback: function</span>
<span class="sd">            A function which is called in place of the viewer display when run outside IPython</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Show all controls in container</span>

        <span class="c1">#Creates an interactor to connect javascript/html controls to IPython and viewer</span>
        <span class="c1">#if no viewer Window() created, it will be a windowless interactor</span>
        <span class="k">if</span> <span class="n">_isviewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">()):</span>
            <span class="c1">#Append the current viewer ref</span>
            <span class="n">windows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">())</span>

        <span class="n">viewerid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span>

        <span class="c1">#Generate the HTML</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;form novalidate&gt;&quot;</span>
        <span class="n">chtml</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">:</span>
            <span class="n">chtml</span> <span class="o">+=</span> <span class="n">c</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chtml</span><span class="p">):</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;div style=&quot;&quot; class=&quot;lvctrl&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">chtml</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="n">c</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/form&gt;&quot;</span>

        <span class="c1">#Set viewer id</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---VIEWERID---&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">viewerid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">+=</span> <span class="n">html</span>

        <span class="c1">#Display HTML inline or export</span>
        <span class="k">if</span> <span class="n">is_notebook</span><span class="p">():</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;LavaVu HTTP Server must be active for interactive controls, set port= parameter to &gt; 0&quot;</span><span class="p">))</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            HTTP server mode interaction, rendering in separate render thread:</span>
<span class="sd">             - This should work in all notebook contexts, colab, jupyterlab etc</span>
<span class="sd">             - Only problem remaining is port access, from docker or cloud instances etc, need to forward port</span>
<span class="sd">             - jupyter-server-proxy packaged (available on pip) supports forwarding port via the jupyter server</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">HTML</span>
            <span class="c1">#Interaction requires some additional js/css/webgl</span>
            <span class="c1">#Insert stylesheet, shaders and combined javascript libraries</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">_webglboxcode</span><span class="p">()))</span>

            <span class="c1">#Try and prevent this getting cached</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!-- CREATION TIMESTAMP </span><span class="si">{0}</span><span class="s2"> --&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>

            <span class="c1">#Pass port and object id from server</span>
            <span class="n">actionjs</span> <span class="o">=</span> <span class="n">_Action</span><span class="o">.</span><span class="n">export_actions</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">obj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="c1">#Output the controls and start interactor</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;script&gt;init(</span><span class="si">{0}</span><span class="s2">);&lt;/script&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">viewerid</span><span class="p">)</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">actionjs</span> <span class="o">+</span> <span class="n">html</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Export html file</span>
            <span class="n">_Action</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">fallback</span><span class="p">):</span> <span class="n">fallback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">())</span>

        <span class="c1">#Auto-clear after show?</span>
        <span class="c1">#Prevents doubling up if cell executed again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1">#Pause to let everything catch up</span>
        <span class="c1">#time.sleep(.5)</span>

    <span class="k">def</span> <span class="nf">redisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the active viewer image if any</span>
<span class="sd">        Applies changes made in python to the viewer and forces a redisplay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_notebook</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="c1">#Find matching viewer id, redisplay all that match</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">windows</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">():</span>
                <span class="n">viewerid</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
                <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">HTML</span>
                <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;script&gt;_wi[</span><span class="si">{0}</span><span class="s1">].redisplay(</span><span class="si">{0}</span><span class="s1">);&lt;/script&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">viewerid</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the control values from current viewer data</span>
<span class="sd">        Applies changes made in python to the UI controls</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#NOTE: to do this now, all we need is to trigger a get_state call from interactor by sending any command</span>
        <span class="c1">#TODO: currently only works for controllers with a window, other controls will not be updated</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_notebook</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="c1">#Find matching viewer id, update all that match</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">windows</span><span class="p">):</span>
            <span class="c1">#if obj == self._target():</span>
            <span class="n">viewerid</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
            <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span><span class="p">,</span><span class="n">HTML</span>
            <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;script&gt;_wi[</span><span class="si">{0}</span><span class="s1">].execute(&quot; &quot;);&lt;/script&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">viewerid</span><span class="p">)))</span>
        
    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span> <span class="o">=</span> <span class="p">[]</span>


</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">LavaVu 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Monash University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>